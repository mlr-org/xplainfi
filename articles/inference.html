<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Inference for Feature Importance • xplainfi</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Inference for Feature Importance">
<script defer src="https://umami.jemu.name/script.js" data-website-id="248c8668-4908-4c63-86f7-db0a1b19758a"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Method Showcase</h6></li>
    <li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-Based Methods (PFI, CFI, RFI)</a></li>
    <li><a class="dropdown-item" href="../articles/loco.html">Model Refitting Measures (LOCO, WVIM)</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global ImportancE (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Specialized Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/feature-samplers.html">Feature Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/inference.html">Inference for Feature Importances</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Testing &amp; Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/simulation-settings.html">Simulation Settings</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="inference_files/htmltools-fill-0.5.9/fill.css" rel="stylesheet">
<script src="inference_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="inference_files/viz-1.8.2/viz.js"></script><link href="inference_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="inference_files/grViz-binding-1.0.11/grViz.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Inference for Feature Importance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/xplainfi/blob/main/vignettes/articles/inference.Rmd" class="external-link"><code>vignettes/articles/inference.Rmd</code></a></small>
      <div class="d-none name"><code>inference.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr-org.github.io/xplainfi/">xplainfi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: mlr3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>There are multiple inference methods available for different
importance methods and estimation targets. The approaches fall into two
broad categories:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Resampling-based variability</strong>: When importance is
estimated via resampling (e.g., subsampling), we obtain multiple
importance estimates across iterations. We can summarize this
variability descriptively (empirical quantiles), or use parametric
methods, either naive (raw CIs) or corrected for the dependence
structure of resampling (Nadeau &amp; Bengio).</p></li>
<li><p><strong>Observation-wise inference on test data</strong>: When a
dedicated test set with i.i.d. observations is available (e.g.,
holdout), we can use observation-wise loss differences for formal
statistical inference. This is the basis for CPI/cARFi (conditional
importance) and the Lei et al. method (LOCO inference).</p></li>
</ol>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We use a simple linear DGP for demonstration purposes where</p>
<ul>
<li>
<span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span> are strongly correlated (r =
0.7)</li>
<li>
<span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_3\)</span> have an effect on Y</li>
<li>
<span class="math inline">\(X_2\)</span> and <span class="math inline">\(X_4\)</span> don’t have an effect</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2000</span>, r <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span>, num.trees <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mse"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<div class="grViz html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:960px;height:384px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"\n  digraph Correlated {\n    rankdir=LR;\n    graph [ranksep=1.5];\n    node [shape=circle, style=filled, fontsize=14, width=1.2];\n\n    X1 [fillcolor=\"lightcoral\", label=\"X₁\n(β=2.0)\"];\n    X2 [fillcolor=\"pink\", label=\"X₂\n(β=0)\"];\n    X3 [fillcolor=\"lightblue\", label=\"X₃\n(β=1.0)\"];\n    X4 [fillcolor=\"lightgray\", label=\"X₄\n(β=0)\"];\n    Y [fillcolor=\"greenyellow\", label=\"Y\", width=1.5];\n\n    X1 -> X2 [color=red, style=bold, dir=both, label=\"r = 0.7\"];\n    X1 -> Y [label=\"2.0\"];\n    X2 -> Y [style=dashed, color=gray, label=\"0\"];\n    X3 -> Y [label=\"1.0\"];\n    X4 -> Y [style=dashed, color=gray];\n\n    {rank=source; X1; X3; X4}\n    {rank=same; X2}\n    {rank=sink; Y}\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
DAG for correlated features DGP
</p>
</div>
</div>
<div class="section level2">
<h2 id="resampling-based-variability">Resampling-based variability<a class="anchor" aria-label="anchor" href="#resampling-based-variability"></a>
</h2>
<p>When we compute feature importance with resampling — for example,
subsampling with multiple repeats — each resampling iteration yields a
separate importance estimate. By default, <code>$importance()</code>
simply averages these estimates without reporting any measure of
variability:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi</span> <span class="op">=</span> <span class="va"><a href="../reference/PFI.html">PFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"subsampling"</span>, repeats <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    n_repeats <span class="op">=</span> <span class="fl">20</span> <span class="co"># for stability within resampling iters</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  6.476555494</span></span>
<span><span class="co">#&gt; 2:      x2  0.095842584</span></span>
<span><span class="co">#&gt; 3:      x3  1.793989195</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000962437</span></span></code></pre></div>
<p>There are several ways to quantify the variability of these
estimates, ranging from purely descriptive to parametric inference.</p>
<div class="section level3">
<h3 id="empirical-quantiles">Empirical quantiles<a class="anchor" aria-label="anchor" href="#empirical-quantiles"></a>
</h3>
<p>The simplest approach is to look at the empirical distribution of
importance scores across resampling iterations. This is not a formal
inference method — it merely describes the observed variability without
any distributional assumptions.</p>
<p>The <code>"quantile"</code> method returns only confidence bounds
(<code>conf_lower</code>, <code>conf_upper</code>) without
<code>se</code>, <code>statistic</code>, or <code>p.value</code>, since
empirical quantiles are not a statistical test. The <code>conf_*</code>
naming is kept for consistency with other methods to ease
visualization.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi_ci_quantile</span> <span class="op">=</span> <span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"quantile"</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span></span>
<span><span class="va">pfi_ci_quantile</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance   conf_lower   conf_upper</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  6.476555494  6.108602488 6.8752121255</span></span>
<span><span class="co">#&gt; 2:      x2  0.095842584  0.071144370 0.1213703258</span></span>
<span><span class="co">#&gt; 3:      x3  1.793989195  1.736434146 1.8848348302</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000962437 -0.003342628 0.0006686405</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="raw-confidence-intervals">Raw confidence intervals<a class="anchor" aria-label="anchor" href="#raw-confidence-intervals"></a>
</h3>
<p>A natural next step is to assume the importance scores are
approximately normally distributed across resampling iterations and
compute t-based confidence intervals. However, these
<strong>unadjusted</strong> confidence intervals are too narrow and
hence <strong>invalid for inference</strong>: the resampling iterations
share overlapping training sets, violating the independence assumption
underlying the t-distribution.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi_ci_raw</span> <span class="op">=</span> <span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"raw"</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span></span>
<span><span class="va">pfi_ci_raw</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance           se  statistic      p.value  conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  6.476555494 0.0707450088  91.547879 7.519530e-21  6.32482254</span></span>
<span><span class="co">#&gt; 2:      x2  0.095842584 0.0042155496  22.735490 1.879277e-12  0.08680113</span></span>
<span><span class="co">#&gt; 3:      x3  1.793989195 0.0132950768 134.936355 3.311520e-23  1.76547409</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000962437 0.0002849623  -3.377418 4.511052e-03 -0.00157362</span></span>
<span><span class="co">#&gt;       conf_upper</span></span>
<span><span class="co">#&gt;            &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  6.6282884472</span></span>
<span><span class="co">#&gt; 2:  0.1048840389</span></span>
<span><span class="co">#&gt; 3:  1.8225042988</span></span>
<span><span class="co">#&gt; 4: -0.0003512536</span></span></code></pre></div>
<p>The parametric CI methods (<code>"raw"</code> and
<code>"nadeau_bengio"</code>) return <code>se</code>,
<code>statistic</code>, <code>p.value</code>, <code>conf_lower</code>,
and <code>conf_upper</code>. The <code>alternative</code> parameter
controls whether a one-sided test (<code>"greater"</code>, the default,
testing H0: importance &lt;= 0) or two-sided test
(<code>"two.sided"</code>) is performed. Here we use
<code>alternative = "two.sided"</code> for visualization purposes so
that <code>conf_upper</code> is finite.</p>
</div>
<div class="section level3">
<h3 id="corrected-t-test-nadeau-bengio">Corrected t-test (Nadeau &amp; Bengio)<a class="anchor" aria-label="anchor" href="#corrected-t-test-nadeau-bengio"></a>
</h3>
<p>To account for the dependence between resampling iterations, we can
use the correction proposed by <a href="https://doi.org/10.1023/A:1024068626366" class="external-link">Nadeau &amp; Bengio
(2003)</a> and recommended by <a href="https://doi.org/10.1007/s10618-023-00925-z" class="external-link">Molnar et
al. (2023)</a>. This inflates the variance estimate to account for the
overlap between training sets, yielding wider (and more honest)
confidence intervals:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi_ci_corrected</span> <span class="op">=</span> <span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"nadeau_bengio"</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span><span class="op">)</span></span>
<span><span class="va">pfi_ci_corrected</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance           se statistic      p.value   conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  6.476555494 0.2063236235 31.390276 2.231930e-14  6.034035333</span></span>
<span><span class="co">#&gt; 2:      x2  0.095842584 0.0122944003  7.795629 1.848448e-06  0.069473718</span></span>
<span><span class="co">#&gt; 3:      x3  1.793989195 0.0387743032 46.267477 1.027030e-16  1.710826586</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000962437 0.0008310757 -1.158062 2.662136e-01 -0.002744917</span></span>
<span><span class="co">#&gt;      conf_upper</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 6.9190756552</span></span>
<span><span class="co">#&gt; 2: 0.1222114505</span></span>
<span><span class="co">#&gt; 3: 1.8771518043</span></span>
<span><span class="co">#&gt; 4: 0.0008200431</span></span></code></pre></div>
<p>The Nadeau-Bengio correction provides better (but still imperfect)
coverage compared to the raw approach.</p>
</div>
<div class="section level3">
<h3 id="comparison">Comparison<a class="anchor" aria-label="anchor" href="#comparison"></a>
</h3>
<p>To highlight the differences between all three approaches, we
visualize them side by side:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi_cis</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">pfi_ci_raw</span><span class="op">[</span>, <span class="va">type</span> <span class="op">:=</span> <span class="st">"raw"</span><span class="op">]</span>,</span>
<span>        <span class="va">pfi_ci_corrected</span><span class="op">[</span>, <span class="va">type</span> <span class="op">:=</span> <span class="st">"nadeau_bengio"</span><span class="op">]</span>,</span>
<span>        <span class="va">pfi_ci_quantile</span><span class="op">[</span>, <span class="va">type</span> <span class="op">:=</span> <span class="st">"quantile"</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pfi_cis</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">feature</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">conf_lower</span>, xmax <span class="op">=</span> <span class="va">conf_upper</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">.5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">importance</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Parametric &amp; non-parametric CI methods"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"RF with 15 subsampling iterations"</span>,</span>
<span>        color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="inference_files/figure-html/pfi-ci-comparison-1.png" class="r-plt" alt="Point-and-whisker plot with features on y-axis and importance on x-axis. Three colored points for raw, nadeau_bengio, and quantile CI methods, each showing point estimates with horizontal error bars." width="768"></p>
<p>The results highlight just how optimistic the unadjusted, raw
confidence intervals are.</p>
</div>
<div class="section level3">
<h3 id="multiplicity-correction">Multiplicity correction<a class="anchor" aria-label="anchor" href="#multiplicity-correction"></a>
</h3>
<p>When testing many features simultaneously, p-values should be
adjusted to control the overall error rate. There are two main
frameworks for multiplicity correction:</p>
<ul>
<li><p><strong>Family-wise error rate (FWER)</strong>: The probability
of making <em>at least one</em> false rejection among all tests. FWER
control is the more conservative approach and is appropriate when any
single false positive would be costly. Methods include Bonferroni (<span class="math inline">\(\alpha / k\)</span>) and Holm (a step-down variant
that is uniformly more powerful than Bonferroni while still controlling
FWER).</p></li>
<li><p><strong>False discovery rate (FDR)</strong>: The expected
<em>proportion</em> of false rejections among all rejected hypotheses.
FDR control is less conservative and better suited for exploratory
analyses where some false positives are tolerable. The most common
method is Benjamini-Hochberg (BH).</p></li>
</ul>
<p>The <code>p_adjust</code> parameter accepts any method from
<code><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">stats::p.adjust.methods</a></code> and defaults to <code>"none"</code>
(no adjustment).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"nadeau_bengio"</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span>, p_adjust <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance           se statistic      p.value   conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  6.476555494 0.2063236235 31.390276 2.231930e-14  6.034035333</span></span>
<span><span class="co">#&gt; 2:      x2  0.095842584 0.0122944003  7.795629 1.848448e-06  0.069473718</span></span>
<span><span class="co">#&gt; 3:      x3  1.793989195 0.0387743032 46.267477 1.027030e-16  1.710826586</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000962437 0.0008310757 -1.158062 2.662136e-01 -0.002744917</span></span>
<span><span class="co">#&gt;      conf_upper</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 6.9190756552</span></span>
<span><span class="co">#&gt; 2: 0.1222114505</span></span>
<span><span class="co">#&gt; 3: 1.8771518043</span></span>
<span><span class="co">#&gt; 4: 0.0008200431</span></span></code></pre></div>
<p>With Bonferroni correction (FWER control), both p-values and
confidence intervals are adjusted. The confidence intervals use an
adjusted significance level of <span class="math inline">\(\alpha /
k\)</span> where <span class="math inline">\(k\)</span> is the number of
features:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"nadeau_bengio"</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span>, p_adjust <span class="op">=</span> <span class="st">"bonferroni"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance           se statistic      p.value   conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  6.476555494 0.2063236235 31.390276 8.927721e-14  5.885645869</span></span>
<span><span class="co">#&gt; 2:      x2  0.095842584 0.0122944003  7.795629 7.393792e-06  0.060631495</span></span>
<span><span class="co">#&gt; 3:      x3  1.793989195 0.0387743032 46.267477 4.108119e-16  1.682939822</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000962437 0.0008310757 -1.158062 1.000000e+00 -0.003342633</span></span>
<span><span class="co">#&gt;     conf_upper</span></span>
<span><span class="co">#&gt;          &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 7.067465120</span></span>
<span><span class="co">#&gt; 2: 0.131053673</span></span>
<span><span class="co">#&gt; 3: 1.905038568</span></span>
<span><span class="co">#&gt; 4: 0.001417759</span></span></code></pre></div>
<p>For sequential or adaptive procedures such as Holm (FWER) or
Benjamini-Hochberg (FDR), only p-values are adjusted. These methods do
not yield a clean per-comparison <span class="math inline">\(\alpha\)</span> that could be used for CI
construction, so confidence intervals remain at the nominal level:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"nadeau_bengio"</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span>, p_adjust <span class="op">=</span> <span class="st">"BH"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance           se statistic      p.value   conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;     &lt;num&gt;        &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  6.476555494 0.2063236235 31.390276 4.463861e-14  6.034035333</span></span>
<span><span class="co">#&gt; 2:      x2  0.095842584 0.0122944003  7.795629 2.464597e-06  0.069473718</span></span>
<span><span class="co">#&gt; 3:      x3  1.793989195 0.0387743032 46.267477 4.108119e-16  1.710826586</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000962437 0.0008310757 -1.158062 2.662136e-01 -0.002744917</span></span>
<span><span class="co">#&gt;      conf_upper</span></span>
<span><span class="co">#&gt;           &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 6.9190756552</span></span>
<span><span class="co">#&gt; 2: 0.1222114505</span></span>
<span><span class="co">#&gt; 3: 1.8771518043</span></span>
<span><span class="co">#&gt; 4: 0.0008200431</span></span></code></pre></div>
<p>This applies to all <code>ci_method</code>s that produce p-values
(<code>"raw"</code>, <code>"nadeau_bengio"</code>, <code>"cpi"</code>,
<code>"lei"</code>).</p>
</div>
</div>
<div class="section level2">
<h2 id="observation-wise-inference-on-test-data">Observation-wise inference on test data<a class="anchor" aria-label="anchor" href="#observation-wise-inference-on-test-data"></a>
</h2>
<p>The resampling-based approaches above quantify variability due to the
choice of train/test split. A different approach uses
<strong>observation-wise loss differences</strong> on a test set for
formal statistical inference.</p>
<p>The idea is straightforward: for each test observation, we compare
the loss with and without a feature (either by perturbing the feature or
by retraining the model without it). The resulting per-observation
importance scores are i.i.d. under appropriate conditions, enabling
standard statistical tests.</p>
<p>Inference is guaranteed to be valid with a single train/test split
(holdout), where test observations are truly i.i.d. and the model is
fixed. Other resampling strategies may be used but come with caveats
(see below).</p>
<ul>
<li>
<strong>CPI / cARFi</strong> for conditional feature importance
(perturbation-based, model is fixed per resampling iteration)</li>
<li>
<strong>Lei et al.</strong> for LOCO importance (retraining-based,
model is refitted without each feature)</li>
</ul>
<div class="section level3">
<h3 id="conditional-predictive-impact-cpi">Conditional predictive impact (CPI)<a class="anchor" aria-label="anchor" href="#conditional-predictive-impact-cpi"></a>
</h3>
<p>CPI (Conditional Predictive Impact) was introduced by <a href="https://doi.org/10.1007/s10994-021-06030-6" class="external-link">Watson &amp; Wright
(2021)</a> for statistical inference with conditional feature importance
using knockoffs. Two main approaches are supported:</p>
<ul>
<li>
<strong>CPI with knockoffs</strong>: The original method using
model-X knockoffs for conditional sampling.</li>
<li>
<strong>cARFi</strong> (Blesch et al., 2025): Uses Adversarial
Random Forests for conditional sampling, which works without Gaussian
assumptions and supports mixed data. CPI is originally implemented by <a href="https://bips-hb.github.io/cpi/articles/intro.html" class="external-link">the cpi
package</a>. It works with <code>mlr3</code> and its output on our data
looks like this:</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bips-hb/cpi" class="external-link">cpi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">resampling</span><span class="op">$</span><span class="fu">instantiate</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cpi_res</span> <span class="op">=</span> <span class="fu"><a href="https://bips-hb.github.io/cpi/reference/cpi.html" class="external-link">cpi</a></span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    test <span class="op">=</span> <span class="st">"t"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">cpi_res</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">cpi_res</span>, <span class="st">"Variable"</span>, <span class="st">"feature"</span><span class="op">)</span></span>
<span><span class="va">cpi_res</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">"CPI"</span><span class="op">]</span></span>
<span></span>
<span><span class="va">cpi_res</span></span>
<span><span class="co">#&gt;    feature           CPI          SE   test  statistic      estimate</span></span>
<span><span class="co">#&gt;     &lt;char&gt;         &lt;num&gt;       &lt;num&gt; &lt;char&gt;      &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  4.5092929912 0.147978747      t 30.4725717  4.5092929912</span></span>
<span><span class="co">#&gt; 2:      x2  0.0029567621 0.003362453      t  0.8793467  0.0029567621</span></span>
<span><span class="co">#&gt; 3:      x3  1.8536055915 0.060102228      t 30.8408797  1.8536055915</span></span>
<span><span class="co">#&gt; 4:      x4 -0.0008885688 0.000770307      t -1.1535255 -0.0008885688</span></span>
<span><span class="co">#&gt;          p.value        ci.lo method</span></span>
<span><span class="co">#&gt;            &lt;num&gt;        &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1: 3.859678e-168  4.265776760    CPI</span></span>
<span><span class="co">#&gt; 2:  1.896595e-01 -0.002576545    CPI</span></span>
<span><span class="co">#&gt; 3: 1.768282e-171  1.754700388    CPI</span></span>
<span><span class="co">#&gt; 4:  8.755837e-01 -0.002156198    CPI</span></span></code></pre></div>
<div class="section level4">
<h4 id="cpi-with-knockoffs">CPI with knockoffs<a class="anchor" aria-label="anchor" href="#cpi-with-knockoffs"></a>
</h4>
<p>Since <code>xplainfi</code> also includes knockoffs via the
<code>KnockoffSampler</code> and the
<code>KnockoffGaussianSampler</code>, the latter implementing the second
order Gaussian knockoffs also used by default in <a href="https://github.com/bips-hb/cpi" class="external-link">cpi</a>, we
can recreate its results using <code>CFI</code> with the corresponding
<code>sampler</code>.</p>
<p><code>CFI</code> with a knockoff sampler supports CPI inference
directly via <code>ci_method = "cpi"</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knockoff_gaussian</span> <span class="op">=</span> <span class="va"><a href="../reference/KnockoffGaussianSampler.html">KnockoffGaussianSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfi</span> <span class="op">=</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    sampler <span class="op">=</span> <span class="va">knockoff_gaussian</span>,</span>
<span>    n_repeats <span class="op">=</span> <span class="fl">1</span> <span class="co"># generate 1 knockoff matrix, like cpi()</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfi_cpi_res</span> <span class="op">=</span> <span class="va">cfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"cpi"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Observation-wise inference was validated with a single test set.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Current resampling has <span style="color: #0000BB;">5</span> iterations.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With cross-validation, models are fit on overlapping training data, which may</span></span>
<span><span class="co">#&gt;   affect coverage.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With bootstrap or subsampling, test observations are not i.i.d.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `vignette("inference", package = "xplainfi")` for details.</span></span>
<span><span class="va">cfi_cpi_res</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature   importance           se  statistic       p.value   conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;        &lt;num&gt;        &lt;num&gt;      &lt;num&gt;         &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  4.362355571 0.1355320358 32.1868962 8.486605e-184  4.139321851</span></span>
<span><span class="co">#&gt; 2:      x2  0.001742650 0.0029223989  0.5963079  2.755185e-01 -0.003066498</span></span>
<span><span class="co">#&gt; 3:      x3  1.769344462 0.0548657780 32.2485988 2.290447e-184  1.679056446</span></span>
<span><span class="co">#&gt; 4:      x4 -0.000470146 0.0009370589 -0.5017251  6.920419e-01 -0.002012185</span></span>
<span><span class="co">#&gt;    conf_upper</span></span>
<span><span class="co">#&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Inf</span></span>
<span><span class="co">#&gt; 2:        Inf</span></span>
<span><span class="co">#&gt; 3:        Inf</span></span>
<span><span class="co">#&gt; 4:        Inf</span></span>
<span></span>
<span><span class="co"># Rename columns to match cpi package output for comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">cfi_cpi_res</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"importance"</span>, <span class="st">"conf_lower"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CPI"</span>, <span class="st">"ci.lo"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cfi_cpi_res</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">"CFI+Knockoffs"</span><span class="op">]</span></span></code></pre></div>
<p>The results should be very similar to those computed by
<code><a href="https://bips-hb.github.io/cpi/reference/cpi.html" class="external-link">cpi()</a></code>, so let’s compare them:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cpi_res</span>, <span class="va">cfi_cpi_res</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">feature</span>, x <span class="op">=</span> <span class="va">CPI</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">CPI</span>, xmax <span class="op">=</span> <span class="va">ci.lo</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"CPI and CFI with Knockoff sampler"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"RF with 5-fold CV"</span>,</span>
<span>        color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="inference_files/figure-html/cpi-cfi-plot-1.png" class="r-plt" alt="Point-and-whisker plot with features on y-axis and CPI values on x-axis. Two colored points for CPI and CFI+Knockoffs methods with horizontal error bars." width="768"></p>
<p>A noteable caveat of the knockoff approach is that they are not
readily available for mixed data (with categorical features).</p>
</div>
<div class="section level4">
<h4 id="carfi-cpi-with-arf">cARFi: CPI with ARF<a class="anchor" aria-label="anchor" href="#carfi-cpi-with-arf"></a>
</h4>
<p>An alternative is available using ARF as conditional sampler rather
than knockoffs. This approach, called cARFi, was introduced by <a href="https://doi.org/10.1609/aaai.v39i15.33712" class="external-link">Blesch et
al. (2025)</a> and works without Gaussian assumptions:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">arf_sampler</span> <span class="op">=</span> <span class="va"><a href="../reference/ConditionalARFSampler.html">ConditionalARFSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    finite_bounds <span class="op">=</span> <span class="st">"local"</span>,</span>
<span>    min_node_size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    epsilon <span class="op">=</span> <span class="fl">1e-15</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfi_arf</span> <span class="op">=</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    sampler <span class="op">=</span> <span class="va">arf_sampler</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cfi_arf</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># CPI inference with ARF sampler (cARFi)</span></span>
<span><span class="va">cfi_arf_res</span> <span class="op">=</span> <span class="va">cfi_arf</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"cpi"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Observation-wise inference was validated with a single test set.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Current resampling has <span style="color: #0000BB;">5</span> iterations.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With cross-validation, models are fit on overlapping training data, which may</span></span>
<span><span class="co">#&gt;   affect coverage.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With bootstrap or subsampling, test observations are not i.i.d.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `vignette("inference", package = "xplainfi")` for details.</span></span>
<span><span class="va">cfi_arf_res</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature    importance           se statistic    p.value   conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;         &lt;num&gt;        &lt;num&gt;     &lt;num&gt;      &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  3.9865071718 0.0715166883 55.742335 0.00000000  3.868818148</span></span>
<span><span class="co">#&gt; 2:      x2  0.0053611218 0.0025570164  2.096632 0.01807579  0.001153254</span></span>
<span><span class="co">#&gt; 3:      x3  1.7527732858 0.0325190020 53.899972 0.00000000  1.699259488</span></span>
<span><span class="co">#&gt; 4:      x4 -0.0009391978 0.0004918991 -1.909330 0.97181872 -0.001748675</span></span>
<span><span class="co">#&gt;    conf_upper</span></span>
<span><span class="co">#&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Inf</span></span>
<span><span class="co">#&gt; 2:        Inf</span></span>
<span><span class="co">#&gt; 3:        Inf</span></span>
<span><span class="co">#&gt; 4:        Inf</span></span>
<span></span>
<span><span class="co"># Rename columns to match cpi package output for comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">cfi_arf_res</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"importance"</span>, <span class="st">"conf_lower"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CPI"</span>, <span class="st">"ci.lo"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cfi_arf_res</span><span class="op">[</span>, <span class="va">method</span> <span class="op">:=</span> <span class="st">"CFI+ARF"</span><span class="op">]</span></span></code></pre></div>
<p>We can now compare all three methods:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cpi_res</span>, <span class="va">cfi_cpi_res</span>, <span class="va">cfi_arf_res</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">feature</span>, x <span class="op">=</span> <span class="va">CPI</span>, color <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">CPI</span>, xmax <span class="op">=</span> <span class="va">ci.lo</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"CPI and CFI with Knockoffs and ARF"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"RF with 5-fold CV"</span>,</span>
<span>        color <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="inference_files/figure-html/cpi-cfi-arf-plot-1.png" class="r-plt" alt="Point-and-whisker plot with features on y-axis and CPI values on x-axis. Three colored points for CPI, CFI+Knockoffs, and CFI+ARF methods with horizontal error bars." width="768"></p>
<p>As expected, the ARF-based approach differs more from both
knockoff-based approaches, but they are all roughly in agreement.</p>
<p><strong>Note on resampling strategy:</strong> CPI inference was
validated using holdout (a single train/test split), and inference is
provably valid in this setting. With cross-validation, test observations
are still i.i.d., but models are fit on overlapping training data —
technically, this affects inference for the same reason the Nadeau &amp;
Bengio correction exists for resampling-based CIs. With bootstrap or
subsampling, test observations may no longer be i.i.d. (due to repeated
observations across test sets) <em>and</em> training sets overlap. In
practice, Watson &amp; Wright (2021) found that empirical results did
not strongly depend on the choice of risk estimator, but
<strong>inference is only guaranteed to be valid with holdout</strong>.
Other resampling strategies should be employed with the understanding
that coverage guarantees may not hold.</p>
</div>
<div class="section level4">
<h4 id="statistical-tests-with-cpi">Statistical tests with CPI<a class="anchor" aria-label="anchor" href="#statistical-tests-with-cpi"></a>
</h4>
<p>CPI can also perform additional tests besides the default t-test,
specifically the Wilcoxon-, Fisher-, or binomial test:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">cpi_res_wilcoxon</span> <span class="op">=</span> <span class="va">cfi_arf</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"cpi"</span>, test <span class="op">=</span> <span class="st">"wilcoxon"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Observation-wise inference was validated with a single test set.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Current resampling has <span style="color: #0000BB;">5</span> iterations.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With cross-validation, models are fit on overlapping training data, which may</span></span>
<span><span class="co">#&gt;   affect coverage.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With bootstrap or subsampling, test observations are not i.i.d.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `vignette("inference", package = "xplainfi")` for details.</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature    importance    se statistic      p.value    conf_lower conf_upper</span></span>
<span><span class="co">#&gt;     &lt;char&gt;         &lt;num&gt; &lt;num&gt;     &lt;num&gt;        &lt;num&gt;         &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  3.9865071718    NA   2001000 0.000000e+00  3.2285614819        Inf</span></span>
<span><span class="co">#&gt; 2:      x2  0.0053611218    NA   1194853 2.647776e-14  0.0031150313        Inf</span></span>
<span><span class="co">#&gt; 3:      x3  1.7527732858    NA   2000886 0.000000e+00  1.4036366255        Inf</span></span>
<span><span class="co">#&gt; 4:      x4 -0.0009391978    NA   1031351 1.161633e-01 -0.0001004833        Inf</span></span>
<span><span class="co"># Fisher test with same default for B as in cpi()</span></span>
<span><span class="op">(</span><span class="va">cpi_res_fisher</span> <span class="op">=</span> <span class="va">cfi_arf</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"cpi"</span>, test <span class="op">=</span> <span class="st">"fisher"</span>, B <span class="op">=</span> <span class="fl">1999</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Observation-wise inference was validated with a single test set.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Current resampling has <span style="color: #0000BB;">5</span> iterations.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With cross-validation, models are fit on overlapping training data, which may</span></span>
<span><span class="co">#&gt;   affect coverage.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With bootstrap or subsampling, test observations are not i.i.d.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `vignette("inference", package = "xplainfi")` for details.</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature    importance    se     statistic p.value   conf_lower conf_upper</span></span>
<span><span class="co">#&gt;     &lt;char&gt;         &lt;num&gt; &lt;num&gt;         &lt;num&gt;   &lt;num&gt;        &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  3.9865071718    NA  3.9865071718  0.0005  3.802012761        Inf</span></span>
<span><span class="co">#&gt; 2:      x2  0.0053611218    NA  0.0053611218  0.0215  0.001095074        Inf</span></span>
<span><span class="co">#&gt; 3:      x3  1.7527732858    NA  1.7527732858  0.0005  1.668688790        Inf</span></span>
<span><span class="co">#&gt; 4:      x4 -0.0009391978    NA -0.0009391978  0.9670 -0.001773247        Inf</span></span>
<span><span class="op">(</span><span class="va">cpi_res_binom</span> <span class="op">=</span> <span class="va">cfi_arf</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"cpi"</span>, test <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Observation-wise inference was validated with a single test set.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Current resampling has <span style="color: #0000BB;">5</span> iterations.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With cross-validation, models are fit on overlapping training data, which may</span></span>
<span><span class="co">#&gt;   affect coverage.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With bootstrap or subsampling, test observations are not i.i.d.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `vignette("inference", package = "xplainfi")` for details.</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature    importance    se statistic      p.value conf_lower conf_upper</span></span>
<span><span class="co">#&gt;     &lt;char&gt;         &lt;num&gt; &lt;num&gt;     &lt;num&gt;        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  3.9865071718    NA      2000 0.000000e+00  0.9985033          1</span></span>
<span><span class="co">#&gt; 2:      x2  0.0053611218    NA      1215 2.994368e-22  0.5891816          1</span></span>
<span><span class="co">#&gt; 3:      x3  1.7527732858    NA      1995 0.000000e+00  0.9947507          1</span></span>
<span><span class="co">#&gt; 4:      x4 -0.0009391978    NA      1094 1.430053e-05  0.5283991          1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="va">cfi_arf</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"cpi"</span><span class="op">)</span><span class="op">[</span>, <span class="va">test</span> <span class="op">:=</span> <span class="st">"t"</span><span class="op">]</span>,</span>
<span>        <span class="va">cpi_res_wilcoxon</span><span class="op">[</span>, <span class="va">test</span> <span class="op">:=</span> <span class="st">"Wilcoxon"</span><span class="op">]</span>,</span>
<span>        <span class="va">cpi_res_fisher</span><span class="op">[</span>, <span class="va">test</span> <span class="op">:=</span> <span class="st">"Fisher"</span><span class="op">]</span>,</span>
<span>        <span class="va">cpi_res_binom</span><span class="op">[</span>, <span class="va">test</span> <span class="op">:=</span> <span class="st">"Binomial"</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">feature</span>, x <span class="op">=</span> <span class="va">importance</span>, color <span class="op">=</span> <span class="va">test</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">importance</span>, xmax <span class="op">=</span> <span class="va">conf_lower</span><span class="op">)</span>,</span>
<span>        position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>        width <span class="op">=</span> <span class="fl">0.5</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"CPI test with CFI/ARF"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"RF with 5-fold CV"</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"Test"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Observation-wise inference was validated with a single test set.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Current resampling has <span style="color: #0000BB;">5</span> iterations.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With cross-validation, models are fit on overlapping training data, which may</span></span>
<span><span class="co">#&gt;   affect coverage.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With bootstrap or subsampling, test observations are not i.i.d.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `vignette("inference", package = "xplainfi")` for details.</span></span></code></pre></div>
<p><img src="inference_files/figure-html/cpi-tests-1.png" class="r-plt" alt="Point-and-whisker plot with features on y-axis and importance on x-axis. Four colored series for t, Wilcoxon, Fisher, and Binomial tests with horizontal error bars." width="768"></p>
<p>The choice of test depends on distributional assumptions: the t-test
assumes normality, while Fisher and Wilcoxon are non-parametric
alternatives.</p>
<p>Following Watson &amp; Wright (2021), we can additionaly apply
Benjamini-Hochberg FDR control (<code>p_adjust = "BH"</code>), which is
often desirable in exploratory settings where many features are tested
simultaneously:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfi_arf</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span>ci_method <span class="op">=</span> <span class="st">"cpi"</span>, p_adjust <span class="op">=</span> <span class="st">"BH"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Observation-wise inference was validated with a single test set.</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Current resampling has <span style="color: #0000BB;">5</span> iterations.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With cross-validation, models are fit on overlapping training data, which may</span></span>
<span><span class="co">#&gt;   affect coverage.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> With bootstrap or subsampling, test observations are not i.i.d.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> See `vignette("inference", package = "xplainfi")` for details.</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature    importance           se statistic    p.value   conf_lower</span></span>
<span><span class="co">#&gt;     &lt;char&gt;         &lt;num&gt;        &lt;num&gt;     &lt;num&gt;      &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1  3.9865071718 0.0715166883 55.742335 0.00000000  3.868818148</span></span>
<span><span class="co">#&gt; 2:      x2  0.0053611218 0.0025570164  2.096632 0.02410105  0.001153254</span></span>
<span><span class="co">#&gt; 3:      x3  1.7527732858 0.0325190020 53.899972 0.00000000  1.699259488</span></span>
<span><span class="co">#&gt; 4:      x4 -0.0009391978 0.0004918991 -1.909330 0.97181872 -0.001748675</span></span>
<span><span class="co">#&gt;    conf_upper</span></span>
<span><span class="co">#&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:        Inf</span></span>
<span><span class="co">#&gt; 2:        Inf</span></span>
<span><span class="co">#&gt; 3:        Inf</span></span>
<span><span class="co">#&gt; 4:        Inf</span></span></code></pre></div>
<p>Note that multiplcity adjustment is in the general case limited to
p-values, and only the general Bonferroni method is easily applicable to
confidence intervals.</p>
</div>
</div>
<div class="section level3">
<h3 id="distribution-free-inference-for-loco-lei-et-al--2018">Distribution-free inference for LOCO (Lei et al., 2018)<a class="anchor" aria-label="anchor" href="#distribution-free-inference-for-loco-lei-et-al--2018"></a>
</h3>
<p><a href="https://doi.org/10.1080/01621459.2017.1307116" class="external-link">Lei et
al. (2018)</a> proposed distribution-free inference for LOCO importance
based on observation-wise loss differences. Unlike CPI/cARFi, LOCO
requires retraining the model without each feature. The inference is
conditional on the training data <span class="math inline">\(D_1\)</span> from a single train/test split: the
observation-wise loss differences on the test set are i.i.d. given <span class="math inline">\(D_1\)</span>, enabling nonparametric tests. The
idea is to test whether the excess test error from removing feature
<span class="math inline">\(j\)</span> is significantly greater than
zero:</p>
<p><span class="math display">\[
\theta_j = \mathrm{med}\left(
    |Y - \hat{f}_{n_1}^{-j}(X)| - |Y - \hat{f}_{n_1}(X)| \big| D_1
\right)
\]</span></p>
<p>The paper proposes:</p>
<ul>
<li>
<strong>L1 (absolute) loss</strong> as the measure</li>
<li>
<strong>Median</strong> as the aggregation function</li>
<li>A <strong>single train/test split</strong> (holdout), since
inference is conditional on the training data</li>
<li>A <strong>Wilcoxon signed-rank test</strong> (or sign test) for
inference</li>
<li>
<strong>Bonferroni correction</strong> for multiple comparisons</li>
</ul>
<p>This is available in <code>xplainfi</code> via
<code>ci_method = "lei"</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mae has L1 loss on observation-level, the "mean" aggregation is ignored here</span></span>
<span><span class="va">measure_mae</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mae"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loco</span> <span class="op">=</span> <span class="va"><a href="../reference/LOCO.html">LOCO</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2000</span>, r <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span>,</span>
<span>    learner <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span>, num.trees <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure_mae</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loco</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">loco</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span></span>
<span>    ci_method <span class="op">=</span> <span class="st">"lei"</span>,</span>
<span>    alternative <span class="op">=</span> <span class="st">"two.sided"</span>,</span>
<span>    p_adjust <span class="op">=</span> <span class="st">"bonferroni"</span>,</span>
<span>    aggregator <span class="op">=</span> <span class="va">median</span> <span class="co"># default spelled out explicitly</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature importance    se statistic      p.value conf_lower conf_upper</span></span>
<span><span class="co">#&gt;     &lt;char&gt;      &lt;num&gt; &lt;num&gt;     &lt;num&gt;        &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1 0.80833037    NA    216167 9.828138e-98 0.82052360 1.00057066</span></span>
<span><span class="co">#&gt; 2:      x2 0.01819719    NA    135421 5.538819e-06 0.01210851 0.03837064</span></span>
<span><span class="co">#&gt; 3:      x3 0.52495928    NA    211296 5.603680e-89 0.51589328 0.64318191</span></span>
<span><span class="co">#&gt; 4:      x4 0.01989962    NA    146280 9.639960e-12 0.01774627 0.03932460</span></span></code></pre></div>
<p>The <code>ci_method = "lei"</code> method works on observation-wise
loss differences internally, using the median as the default point
estimate and the Wilcoxon signed-rank test for confidence intervals and
p-values.</p>
<div class="section level4">
<h4 id="configurable-parameters">Configurable parameters<a class="anchor" aria-label="anchor" href="#configurable-parameters"></a>
</h4>
<p>All components proposed by Lei et al. are the defaults but can be
customized:</p>
<ul>
<li>
<code>test</code>: <code>"wilcoxon"</code> (default),
<code>"t"</code>, <code>"fisher"</code>, or <code>"binomial"</code>
(sign test)</li>
<li>
<code>aggregator</code>: defaults to <code><a href="https://rdrr.io/r/stats/median.html" class="external-link">stats::median</a></code>, can
be changed (e.g. <code>mean</code>)</li>
<li>
<code>p_adjust</code>: p-value correction for multiple comparisons,
accepts any method from <code><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">stats::p.adjust.methods</a></code>
(e.g. <code>"bonferroni"</code>, <code>"holm"</code>, <code>"BH"</code>,
<code>"none"</code>). Default is <code>"none"</code>. When
<code>"bonferroni"</code>, confidence intervals are also adjusted
(alpha/k). For other methods like <code>"holm"</code> or
<code>"BH"</code>, only p-values are adjusted because these
sequential/adaptive procedures do not yield a clean per-comparison alpha
for CI construction.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loco</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span></span>
<span>    ci_method <span class="op">=</span> <span class="st">"lei"</span>,</span>
<span>    test <span class="op">=</span> <span class="st">"t"</span>,</span>
<span>    aggregator <span class="op">=</span> <span class="va">mean</span>,</span>
<span>    alternative <span class="op">=</span> <span class="st">"two.sided"</span>,</span>
<span>    p_adjust <span class="op">=</span> <span class="st">"holm"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature importance          se statistic       p.value conf_lower conf_upper</span></span>
<span><span class="co">#&gt;     &lt;char&gt;      &lt;num&gt;       &lt;num&gt;     &lt;num&gt;         &lt;num&gt;      &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      x1 0.97220860 0.033777130 28.783043 2.152723e-118 0.90588611 1.03853109</span></span>
<span><span class="co">#&gt; 2:      x2 0.04079587 0.007403802  5.510125  5.128595e-08 0.02625827 0.05533348</span></span>
<span><span class="co">#&gt; 3:      x3 0.61203461 0.022878509 26.751508 3.754000e-107 0.56711192 0.65695730</span></span>
<span><span class="co">#&gt; 4:      x4 0.04338934 0.005255062  8.256675  1.611160e-15 0.03307085 0.05370782</span></span></code></pre></div>
<!--
### Why `ci_method = "lei"` and not just MAE + median?

One subtlety is that the standard `$importance()` pipeline (with `ci_method = "none"` or `ci_method = "raw"`) computes the aggregation function per resampling iteration first, then takes the difference:

$$
\mathrm{med}\left(|Y - \hat{f}^{-j}(X)|\right) - \mathrm{med}\left(|Y - \hat{f}(X)|\right)
$$

This is *not* what the paper proposes. Lei et al. take the difference first, then aggregate:

$$
\mathrm{med}\left(|Y - \hat{f}^{-j}(X)| - |Y - \hat{f}(X)|\right)
$$

For the arithmetic mean these are equivalent, but for the median they are not.
The `ci_method = "lei"` implementation handles this correctly by operating on observation-wise loss differences directly.
-->
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
