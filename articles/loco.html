<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>LOCO and WVIM • xplainfi</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="LOCO and WVIM">
<script defer src="https://umami.jemu.name/script.js" data-website-id="248c8668-4908-4c63-86f7-db0a1b19758a"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Method Showcase</h6></li>
    <li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-Based Methods (PFI, CFI, RFI)</a></li>
    <li><a class="dropdown-item" href="../articles/loco.html">Model Refitting Measures (LOCO, WVIM)</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global Importance (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Specialized Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/feature-samplers.html">Feature Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/inference.html">Inference for Feature Importances</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Testing &amp; Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/simulation-settings.html">Simulation Settings</a></li>
    <li><a class="dropdown-item" href="../articles/fippy-comparison.html">Comparison with fippy (Python)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>LOCO and WVIM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/xplainfi/blob/main/vignettes/articles/loco.Rmd" class="external-link"><code>vignettes/articles/loco.Rmd</code></a></small>
      <div class="d-none name"><code>loco.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr-org.github.io/xplainfi/" class="external-link">xplainfi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="example-data-interaction-effects">Example Data: Interaction Effects<a class="anchor" aria-label="anchor" href="#example-data-interaction-effects"></a>
</h2>
<p>To illustrate LOCO feature importance, we’ll use a data generating
process with interaction effects:</p>
<p><span class="math display">\[y = 2 \cdot x_1 \cdot x_2 + x_3 +
\epsilon\]</span></p>
<p>where <span class="math inline">\(\epsilon \sim N(0, 0.5^2)\)</span>
and all features <span class="math inline">\(x_1, x_2, x_3, noise_1,
noise_2 \sim N(0,1)\)</span> are independent.</p>
<p><strong>Key characteristics:</strong></p>
<ul>
<li>
<strong><span class="math inline">\(x_1, x_2\)</span></strong>: Have
NO individual effects, only interact with each other</li>
<li>
<strong><span class="math inline">\(x_3\)</span></strong>: Has a
direct main effect on <span class="math inline">\(y\)</span>
</li>
<li>
<strong><span class="math inline">\(noise_1,
noise_2\)</span></strong>: Pure noise variables with no effect on <span class="math inline">\(y\)</span>
</li>
</ul>
<p>This setup demonstrates how LOCO handles interaction effects.</p>
</div>
<div class="section level2">
<h2 id="leave-one-covariate-out-loco">Leave-One-Covariate-Out (LOCO)<a class="anchor" aria-label="anchor" href="#leave-one-covariate-out-loco"></a>
</h2>
<p>LOCO measures feature importance by comparing model performance with
and without each feature. For each feature, the learner is retrained
without that feature and the performance difference indicates the
feature’s importance.</p>
<p>For feature <span class="math inline">\(j\)</span>, LOCO is
calculated as the difference in expected loss of the model fit without
the feature and the full model: <span class="math display">\[\text{LOCO}_j = \mathbb{E}(L(Y, f_{-j}(X_{-j})))
- \mathbb{E}(L(Y, f(X)))\]</span></p>
<p>Higher values indicate more important features (larger performance
drop when removed).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_interactions</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.nnet"</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mse"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">resampling</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span></span>
<span><span class="va">resampling</span><span class="op">$</span><span class="fu">instantiate</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span>
<span></span>
<span><span class="va">loco</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/LOCO.html">LOCO</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loco</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">loco</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature importance</span></span>
<span><span class="co">#&gt;     &lt;char&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  noise1 -1.1374749</span></span>
<span><span class="co">#&gt; 2:  noise2  0.7842797</span></span>
<span><span class="co">#&gt; 3:      x1  2.7728001</span></span>
<span><span class="co">#&gt; 4:      x2  2.7157750</span></span>
<span><span class="co">#&gt; 5:      x3 -0.1077573</span></span></code></pre></div>
<p>The <code>$importance()</code> method returns a
<code>data.table</code> with aggregated importance scores per
feature.</p>
</div>
<div class="section level2">
<h2 id="understanding-the-results">Understanding the Results<a class="anchor" aria-label="anchor" href="#understanding-the-results"></a>
</h2>
<p><strong>LOCO results interpretation:</strong></p>
<ul>
<li>
<span class="math inline">\(x_3\)</span> should show high importance
due to its direct main effect</li>
<li>
<span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> show variable importance depending on
the model’s ability to capture interactions</li>
<li>
<span class="math inline">\(noise_1\)</span> and <span class="math inline">\(noise_2\)</span> should show low or negative
importance</li>
<li>This demonstrates LOCO measures each feature’s contribution to model
performance</li>
</ul>
</div>
<div class="section level2">
<h2 id="detailed-scores">Detailed Scores<a class="anchor" aria-label="anchor" href="#detailed-scores"></a>
</h2>
<p>The <code>$scores()</code> method provides detailed information for
each feature, resampling iteration, and refit:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loco</span><span class="op">$</span><span class="fu">scores</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"LOCO scores with baseline and post-refit score"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>LOCO scores with baseline and post-refit score</caption>
<colgroup>
<col width="10%">
<col width="13%">
<col width="16%">
<col width="24%">
<col width="19%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">feature</th>
<th align="right">iter_rsmp</th>
<th align="right">iter_repeat</th>
<th align="right">regr.mse_baseline</th>
<th align="right">regr.mse_post</th>
<th align="right">importance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">noise1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.6412</td>
<td align="right">0.5037</td>
<td align="right">-1.1375</td>
</tr>
<tr class="even">
<td align="left">noise2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.6412</td>
<td align="right">2.4255</td>
<td align="right">0.7843</td>
</tr>
<tr class="odd">
<td align="left">x1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.6412</td>
<td align="right">4.4140</td>
<td align="right">2.7728</td>
</tr>
<tr class="even">
<td align="left">x2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.6412</td>
<td align="right">4.3570</td>
<td align="right">2.7158</td>
</tr>
<tr class="odd">
<td align="left">x3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">1.6412</td>
<td align="right">1.5334</td>
<td align="right">-0.1078</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="multiple-refits">Multiple Refits<a class="anchor" aria-label="anchor" href="#multiple-refits"></a>
</h2>
<p>LOCO also supports <code>n_repeats</code> for multiple refits within
each resampling iteration, which improves stability:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loco_multi</span> <span class="op">=</span> <span class="va"><a href="../reference/LOCO.html">LOCO</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    n_repeats <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">loco_multi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">loco_multi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature importance</span></span>
<span><span class="co">#&gt;     &lt;char&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  noise1 0.09783824</span></span>
<span><span class="co">#&gt; 2:  noise2 0.11159219</span></span>
<span><span class="co">#&gt; 3:      x1 3.52161054</span></span>
<span><span class="co">#&gt; 4:      x2 3.54195239</span></span>
<span><span class="co">#&gt; 5:      x3 1.19103822</span></span>
<span></span>
<span><span class="co"># Check individual scores with multiple refits</span></span>
<span><span class="va">loco_multi</span><span class="op">$</span><span class="fu">scores</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span>, caption <span class="op">=</span> <span class="st">"First 10 LOCO scores per refit and resampling fold"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>First 10 LOCO scores per refit and resampling fold</caption>
<colgroup>
<col width="10%">
<col width="13%">
<col width="16%">
<col width="24%">
<col width="19%">
<col width="15%">
</colgroup>
<thead><tr class="header">
<th align="left">feature</th>
<th align="right">iter_rsmp</th>
<th align="right">iter_repeat</th>
<th align="right">regr.mse_baseline</th>
<th align="right">regr.mse_post</th>
<th align="right">importance</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">noise1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.7395</td>
<td align="right">0.5781</td>
<td align="right">-0.1614</td>
</tr>
<tr class="even">
<td align="left">noise2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.7395</td>
<td align="right">0.4073</td>
<td align="right">-0.3322</td>
</tr>
<tr class="odd">
<td align="left">x1</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.7395</td>
<td align="right">4.2616</td>
<td align="right">3.5222</td>
</tr>
<tr class="even">
<td align="left">x2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.7395</td>
<td align="right">4.4070</td>
<td align="right">3.6675</td>
</tr>
<tr class="odd">
<td align="left">x3</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0.7395</td>
<td align="right">3.2243</td>
<td align="right">2.4848</td>
</tr>
<tr class="even">
<td align="left">noise1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.7395</td>
<td align="right">0.3963</td>
<td align="right">-0.3431</td>
</tr>
<tr class="odd">
<td align="left">noise2</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.7395</td>
<td align="right">0.4867</td>
<td align="right">-0.2528</td>
</tr>
<tr class="even">
<td align="left">x1</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.7395</td>
<td align="right">4.3106</td>
<td align="right">3.5711</td>
</tr>
<tr class="odd">
<td align="left">x2</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.7395</td>
<td align="right">4.3204</td>
<td align="right">3.5809</td>
</tr>
<tr class="even">
<td align="left">x3</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0.7395</td>
<td align="right">3.3890</td>
<td align="right">2.6495</td>
</tr>
</tbody>
</table>
<p>Since each refit requires to retrain the provided learner, this of
course increases the computational load. Suitable values depend on the
resources available, but when in doubt it is usually better to overshoot
and encounter diminishing returns rather than undershooting and getting
unreliable results.</p>
</div>
<div class="section level2">
<h2 id="using-different-measures">Using Different Measures<a class="anchor" aria-label="anchor" href="#using-different-measures"></a>
</h2>
<p>LOCO also works with any mlr3 measure. Different measures can
highlight different aspects of feature importance:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use same resampling for fair comparison</span></span>
<span><span class="va">loco_mae</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/LOCO.html">LOCO</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mae"</span><span class="op">)</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparison-with-perturbation-methods">Comparison with Perturbation Methods<a class="anchor" aria-label="anchor" href="#comparison-with-perturbation-methods"></a>
</h2>
<p>LOCO differs from perturbation-based methods like PFI and CFI:</p>
<ul>
<li>
<strong>LOCO</strong>: Retrains model without each feature
(computationally expensive)</li>
<li>
<strong>PFI/CFI</strong>: Perturb feature values using existing
model (faster)</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare LOCO with PFI using same resampling</span></span>
<span><span class="va">pfi</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PFI.html">PFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">measure</span>, resampling <span class="op">=</span> <span class="va">resampling</span><span class="op">)</span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>    <span class="va">loco</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, loco <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, pfi <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature       loco          pfi</span></span>
<span><span class="co">#&gt;     &lt;char&gt;      &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  noise1 -1.1374749  0.002236380</span></span>
<span><span class="co">#&gt; 2:  noise2  0.7842797 -0.001500455</span></span>
<span><span class="co">#&gt; 3:      x1  2.7728001  8.487047597</span></span>
<span><span class="co">#&gt; 4:      x2  2.7157750  7.320215120</span></span>
<span><span class="co">#&gt; 5:      x3 -0.1077573  1.968836648</span></span></code></pre></div>
<p><strong>Note:</strong> Using the same instantiated resampling ensures
we evaluate both methods on identical train/test splits. Even so,
stochastic learners like <code>ranger</code> will produce slightly
different results between methods due to the random forest’s
sampling.</p>
<p>LOCO measures the value of having a feature available during
training, while PFI measures the value of having informative feature
values at prediction time.</p>
</div>
<div class="section level2">
<h2 id="wvim-the-general-framework">WVIM: The General Framework<a class="anchor" aria-label="anchor" href="#wvim-the-general-framework"></a>
</h2>
<p>LOCO is a special case of what Ewald et al. refer to as “Williamson’s
Variable Importance Measure” (WVIM), which provides a general
formulation for refit-based feature importance. WVIM allows both one or
more feature of interest at a time, meaning that via the
<code>groups</code> argument features can be assigned groups which will
always be “left out” or “left in” together. It also as a
<code>direction</code> argument, specifying whether features are left
out or in.</p>
<div class="section level3">
<h3 id="replicating-loco-with-wvim">Replicating LOCO with WVIM<a class="anchor" aria-label="anchor" href="#replicating-loco-with-wvim"></a>
</h3>
<p>We can manually replicate LOCO using WVIM’s <code>"leave-out"</code>
direction. Since <code>features</code> is specified rather than
<code>groups</code>, each feature well be left out one at a time,
resulting in the LOCO procedure.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create WVIM instance (LOCO's parent class) using same resampling</span></span>
<span><span class="va">wvim_loco</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/WVIM.html">WVIM</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    features <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="va">feature_names</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"leave-out"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">wvim_loco</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare with original LOCO results</span></span>
<span><span class="va">comparison_wvim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>    <span class="va">loco</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, loco <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="va">wvim_loco</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, wvim <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_wvim</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature       loco        wvim</span></span>
<span><span class="co">#&gt;     &lt;char&gt;      &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  noise1 -1.1374749  1.73855081</span></span>
<span><span class="co">#&gt; 2:  noise2  0.7842797 -0.09143021</span></span>
<span><span class="co">#&gt; 3:      x1  2.7728001  3.87166836</span></span>
<span><span class="co">#&gt; 4:      x2  2.7157750  3.97399402</span></span>
<span><span class="co">#&gt; 5:      x3 -0.1077573  1.11061754</span></span></code></pre></div>
<p><strong>Note:</strong> To get comparable results between methods, we
must use the same instantiated resampling. Even then, stochastic
learners like <code>ranger</code> will produce slightly different
results due to random forest’s bootstrapping and split selection, but
the overall patterns should be consistent.</p>
</div>
<div class="section level3">
<h3 id="loci-leave-one-covariate-in">LOCI: Leave-One-Covariate-In<a class="anchor" aria-label="anchor" href="#loci-leave-one-covariate-in"></a>
</h3>
<p>WVIM allows us to compute LOCI (Leave-One-Covariate-In) by changing
the direction to “leave-in”. LOCI trains models with only single
features and compares them to a featureless baseline.</p>
<p><strong>Note:</strong> LOCI has questionable utility in practice
because it is essentially just a measure for the bivariate association
between the target and each feature separately. However, WVIM makes it
trivial to compute if desired:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># LOCI: train with only one feature at a time</span></span>
<span><span class="va">wvim_loci</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/WVIM.html">WVIM</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    features <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="va">feature_names</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"leave-in"</span>,</span>
<span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    n_repeats <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wvim_loci</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wvim_loci</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;    feature  importance</span></span>
<span><span class="co">#&gt;     &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  noise1 -0.03103653</span></span>
<span><span class="co">#&gt; 2:  noise2 -0.03631880</span></span>
<span><span class="co">#&gt; 3:      x1 -0.14861338</span></span>
<span><span class="co">#&gt; 4:      x2 -0.19616698</span></span>
<span><span class="co">#&gt; 5:      x3  0.98570545</span></span></code></pre></div>
<p>LOCI interprets importance differently from LOCO:</p>
<ul>
<li>
<strong>LOCO</strong>: “How much does performance degrade when this
feature is removed from the <em>full model</em>?”</li>
<li>
<strong>LOCI</strong>: “How much does this feature alone improve
over a <em>featureless baseline</em>?”</li>
</ul>
<p>For our interaction data where <span class="math inline">\(y = 2
\cdot x_1 \cdot x_2 + x_3 + \epsilon\)</span>:</p>
<ul>
<li>LOCI would be expected to
<ul>
<li>show low importance for <span class="math inline">\(x_1\)</span> and
<span class="math inline">\(x_2\)</span> individually (no main
effects)</li>
<li>show high importance for <span class="math inline">\(x_3\)</span>
(strong main effect)</li>
</ul>
</li>
<li>LOCO better captures the value of features that participate in
interactions</li>
</ul>
<p>However, since we used a random forest learner (ranger), it can not
be expected to learn any meaningful relations based on one training with
onle one feature. This hopefully showcases that LOCI is primarily
“useful” as a teaching exercise, rather than a meaningful importance
measure.</p>
</div>
</div>
<div class="section level2">
<h2 id="wvim-with-feature-groups">WVIM with Feature Groups<a class="anchor" aria-label="anchor" href="#wvim-with-feature-groups"></a>
</h2>
<p>While LOCO measures the importance of individual features, WVIM
generalizes this to arbitrary feature groups. This allows us to measure
the collective importance of sets of features.</p>
<div class="section level3">
<h3 id="understanding-feature-groups">Understanding Feature Groups<a class="anchor" aria-label="anchor" href="#understanding-feature-groups"></a>
</h3>
<p>Feature groups are useful when:</p>
<ul>
<li>Features are naturally related (e.g., dummy-encoded categorical
variables)</li>
<li>You want to measure the importance of feature subsets</li>
<li>Features have known functional relationships</li>
</ul>
<p>Let’s create groups from our interaction data:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define feature groups</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    interaction_pair <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>, <span class="co"># Features that interact</span></span>
<span>    main_effect <span class="op">=</span> <span class="st">"x3"</span>, <span class="co"># Feature with direct effect</span></span>
<span>    noise_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"noise1"</span>, <span class="st">"noise2"</span><span class="op">)</span> <span class="co"># Pure noise</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">groups</span></span>
<span><span class="co">#&gt; $interaction_pair</span></span>
<span><span class="co">#&gt; [1] "x1" "x2"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $main_effect</span></span>
<span><span class="co">#&gt; [1] "x3"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $noise_features</span></span>
<span><span class="co">#&gt; [1] "noise1" "noise2"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wvim-with-leave-out-direction">WVIM with Leave-Out Direction<a class="anchor" aria-label="anchor" href="#wvim-with-leave-out-direction"></a>
</h3>
<p>Using <code>direction = "leave-out"</code>, WVIM computes the
importance of each group by measuring performance when that entire group
is removed:</p>
<p><span class="math display">\[\text{WVIM}_{\text{group}} =
\mathbb{E}(L(Y, f_{-\text{group}}(X_{-\text{group}}))) - \mathbb{E}(L(Y,
f(X)))\]</span></p>
<p>This compares the model without the group to the full model.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wvim_groups_out</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/WVIM.html">WVIM</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"leave-out"</span>,</span>
<span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    n_repeats <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wvim_groups_out</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wvim_groups_out</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;             feature importance</span></span>
<span><span class="co">#&gt;              &lt;char&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: interaction_pair  3.7911190</span></span>
<span><span class="co">#&gt; 2:      main_effect  1.6739042</span></span>
<span><span class="co">#&gt; 3:   noise_features  0.1539716</span></span></code></pre></div>
<p><strong>Interpretation:</strong></p>
<ul>
<li>
<code>interaction_pair</code> (x1, x2) shows the joint contribution
of the interacting features</li>
<li>
<code>main_effect</code> (x3) shows the contribution of the direct
effect</li>
<li>
<code>noise_features</code> should show near-zero or negative
importance</li>
</ul>
</div>
<div class="section level3">
<h3 id="wvim-with-leave-in-direction">WVIM with Leave-In Direction<a class="anchor" aria-label="anchor" href="#wvim-with-leave-in-direction"></a>
</h3>
<p>Using <code>direction = "leave-in"</code>, WVIM trains models with
only each group and compares to a featureless baseline:</p>
<p><span class="math display">\[\text{WVIM}_{\text{group}} =
\mathbb{E}(L(Y, f_{\emptyset})) - \mathbb{E}(L(Y,
f_{\text{group}}(X_{\text{group}})))\]</span></p>
<p>This measures how much each group alone improves over having no
features.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wvim_groups_in</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/WVIM.html">WVIM</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    groups <span class="op">=</span> <span class="va">groups</span>,</span>
<span>    direction <span class="op">=</span> <span class="st">"leave-in"</span>,</span>
<span>    resampling <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">wvim_groups_in</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">wvim_groups_in</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;             feature  importance</span></span>
<span><span class="co">#&gt;              &lt;char&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: interaction_pair  2.17798793</span></span>
<span><span class="co">#&gt; 2:      main_effect  0.99212768</span></span>
<span><span class="co">#&gt; 3:   noise_features -0.07272751</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-leave-out-vs-leave-in-for-groups">Comparing Leave-Out vs Leave-In for Groups<a class="anchor" aria-label="anchor" href="#comparing-leave-out-vs-leave-in-for-groups"></a>
</h3>
<p>The key difference between the two directions is the baseline model
used for comparison:</p>
<ul>
<li>
<strong>Leave-out</strong>: Baseline is the <strong>full
model</strong> with all features
<ul>
<li>Measures: “What do we lose by removing this group?”</li>
<li>Higher values → group is more important to overall model
performance</li>
</ul>
</li>
<li>
<strong>Leave-in</strong>: Baseline is the <strong>empty
model</strong> without any features
<ul>
<li>Measures: “What do we gain by using only this group?”</li>
<li>Higher values → group alone provides better prediction than
baseline</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">comparison_directions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span></span>
<span>    <span class="va">wvim_groups_out</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, leave_out <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="va">wvim_groups_in</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">feature</span>, leave_in <span class="op">=</span> <span class="va">importance</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"feature"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">comparison_directions</span></span>
<span><span class="co">#&gt; Key: &lt;feature&gt;</span></span>
<span><span class="co">#&gt;             feature leave_out    leave_in</span></span>
<span><span class="co">#&gt;              &lt;char&gt;     &lt;num&gt;       &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: interaction_pair 3.7911190  2.17798793</span></span>
<span><span class="co">#&gt; 2:      main_effect 1.6739042  0.99212768</span></span>
<span><span class="co">#&gt; 3:   noise_features 0.1539716 -0.07272751</span></span></code></pre></div>
<p>For our interaction data where <span class="math inline">\(y = 2
\cdot x_1 \cdot x_2 + x_3 + \epsilon\)</span>:</p>
<ul>
<li>
<strong>Leave-out</strong> captures how much each group contributes
to the full model</li>
<li>
<strong>Leave-in</strong> shows that the <code>main_effect</code>
group (x3) provides substantial prediction alone, while the
<code>interaction_pair</code> (x1, x2) has limited predictive power in
isolation</li>
</ul>
<p>This highlights a key insight: features that interact strongly may
show high importance in leave-out (they matter for the full model) but
low importance in leave-in (they don’t work well alone).</p>
</div>
<div class="section level3">
<h3 id="practical-considerations">Practical Considerations<a class="anchor" aria-label="anchor" href="#practical-considerations"></a>
</h3>
<p><strong>When to use feature groups:</strong></p>
<ul>
<li>Analyzing categorical variables (group all dummy columns
together)</li>
<li>Testing domain-specific feature sets (e.g., “demographic features”,
“behavioral features”)</li>
<li>Measuring importance of feature engineering transformations
collectively</li>
</ul>
<p><strong>Computational cost:</strong></p>
<ul>
<li>WVIM requires retraining the model for each group in each resampling
fold</li>
<li>With groups, this is more efficient than analyzing features
individually</li>
<li>Use <code>n_repeats</code> parameter to control the number of refits
per fold for variance estimation</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
