<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Shapley Additive Global Importance (SAGE) • xplainfi</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Shapley Additive Global Importance (SAGE)">
<script defer src="https://umami.jemu.name/script.js" data-website-id="248c8668-4908-4c63-86f7-db0a1b19758a"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9006</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Method Showcase</h6></li>
    <li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-Based Methods (PFI, CFI, RFI)</a></li>
    <li><a class="dropdown-item" href="../articles/loco.html">Model Refitting Measures (LOCO, WVIM)</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global Importance (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Specialized Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/feature-samplers.html">Feature Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/inference.html">Inference for Feature Importances</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Testing &amp; Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/simulation-settings.html">Simulation Settings</a></li>
    <li><a class="dropdown-item" href="../articles/fippy-comparison.html">Comparison with fippy (Python)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jemus42/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Shapley Additive Global Importance (SAGE)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jemus42/xplainfi/blob/main/vignettes/articles/sage-methods.Rmd" class="external-link"><code>vignettes/articles/sage-methods.Rmd</code></a></small>
      <div class="d-none name"><code>sage-methods.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jemus42.github.io/xplainfi/">xplainfi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Shapley Additive Global Importance (SAGE) is a feature importance
method based on cooperative game theory that uses Shapley values to
fairly distribute the total prediction performance among all features.
Unlike permutation-based methods that measure the drop in performance
when features are perturbed, SAGE measures how much each feature
contributes to the model’s overall performance by marginalizing
(removing) features.</p>
<p>The key insight of SAGE is that it provides a complete decomposition
of the model’s performance: the sum of all SAGE values equals the
difference between the model’s performance and the performance when all
features are marginalized.</p>
<p><strong>xplainfi</strong> provides two implementations of SAGE:</p>
<ul>
<li>
<strong>MarginalSAGE</strong>: Marginalizes features independently
(standard SAGE)</li>
<li>
<strong>ConditionalSAGE</strong>: Marginalizes features
conditionally using ARF sampling</li>
</ul>
</div>
<div class="section level2">
<h2 id="demonstration-with-correlated-features">Demonstration with Correlated Features<a class="anchor" aria-label="anchor" href="#demonstration-with-correlated-features"></a>
</h2>
<p>To showcase the difference between Marginal and Conditional SAGE,
we’ll use the <code><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated()</a></code> function which creates a
simple linear DGP with two correlated features.</p>
<p><strong>Model:</strong> <span class="math display">\[(X_1, X_2)^T
\sim \text{MVN}(0, \Sigma)\]</span></p>
<p>where <span class="math inline">\(\Sigma\)</span> is a 2×2 covariance
matrix with 1 on the diagonal and correlation <span class="math inline">\(r\)</span> (default 0.5) on the off-diagonal.</p>
<p><span class="math display">\[X_3 \sim N(0,1), \quad X_4 \sim
N(0,1)\]</span> <span class="math display">\[Y = 2 \cdot X_1 + X_3 +
\varepsilon\]</span></p>
<p>where <span class="math inline">\(\varepsilon \sim N(0,
0.2^2)\)</span>.</p>
<p><strong>Key properties:</strong></p>
<ul>
<li>
<code>x1</code> has a direct causal effect on y (β=2.0)</li>
<li>
<code>x2</code> is correlated with x1 (r = 0.5 from MVN) but has
<strong>no causal effect</strong> on y</li>
<li>
<code>x3</code> is independent with a causal effect (β=1.0)</li>
<li>
<code>x4</code> is independent noise (β=0)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, r <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the correlation structure</span></span>
<span><span class="va">task_data</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">task_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">correlation_matrix</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;        x1     x2     x3     x4</span></span>
<span><span class="co">#&gt; x1  1.000  0.447 -0.005 -0.048</span></span>
<span><span class="co">#&gt; x2  0.447  1.000 -0.049 -0.054</span></span>
<span><span class="co">#&gt; x3 -0.005 -0.049  1.000  0.051</span></span>
<span><span class="co">#&gt; x4 -0.048 -0.054  0.051  1.000</span></span></code></pre></div>
<p><strong>Expected behavior:</strong></p>
<ul>
<li>
<strong>Marginal SAGE</strong>: Should show high importance for both
x1 and x2 due to their correlation, even though x2 has no causal
effect</li>
<li>
<strong>Conditional SAGE</strong>: Should show high importance for
x1 but near-zero importance for x2 (correctly identifying the spurious
predictor)</li>
</ul>
<p>Let’s set up our learner and measure. We’ll use a random forest and
instantiate a resampling to ensure both methods see the same data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mse"</span><span class="op">)</span></span>
<span><span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span></span>
<span><span class="va">resampling</span><span class="op">$</span><span class="fu">instantiate</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="marginal-sage">Marginal SAGE<a class="anchor" aria-label="anchor" href="#marginal-sage"></a>
</h2>
<p>Marginal SAGE marginalizes features independently by averaging
predictions over a reference dataset. This is the standard SAGE
implementation described in the original paper.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Marginal SAGE instance</span></span>
<span><span class="va">marginal_sage</span> <span class="op">=</span> <span class="va"><a href="../reference/MarginalSAGE.html">MarginalSAGE</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    n_permutations <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fl">100L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute SAGE values</span></span>
<span><span class="va">marginal_sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>batch_size <span class="op">=</span> <span class="fl">5000L</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualize the results:</p>
<p><img src="sage-methods_files/figure-html/marginal-sage-plot-1.png" class="r-plt" width="768"></p>
<p>We can also keep track of the SAGE value approximation across
permutations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginal_sage</span><span class="op">$</span><span class="fu">plot_convergence</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sage-methods_files/figure-html/convergance-marginal-1.png" class="r-plt" width="768"></p>
<div class="section level3">
<h3 id="early-stopping-based-on-convergence">Early Stopping Based on Convergence<a class="anchor" aria-label="anchor" href="#early-stopping-based-on-convergence"></a>
</h3>
<p>SAGE supports early stopping to save computation time when the
importance values have converged. By default, early stopping is enabled
with <code>early_stopping = TRUE</code>. Convergence is detected by
monitoring the standard error (SE) of the SAGE value estimates in the
first resampling iteration.</p>
<p><strong>Convergence criterion</strong>: SAGE normalizes the SE by the
range of their values (max - min) to make convergence detection
scale-invariant across different loss metrics. Convergence is detected
when:</p>
<p><span class="math display">\[\max_j
\left(\frac{SE_j}{\max_i(\text{SAGE}_i) - \min_i(\text{SAGE}_i)}\right)
&lt; \text{threshold}\]</span></p>
<p>The default threshold is <code>se_threshold = 0.01</code> (1%),
meaning convergence occurs when the relative SE is below 1% of the
importance range for all features.</p>
<p>You can customize convergence detection in
<code>$compute()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># More strict convergence (requires more permutations)</span></span>
<span><span class="va">sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>early_stopping <span class="op">=</span> <span class="cn">TRUE</span>, se_threshold <span class="op">=</span> <span class="fl">0.005</span>, min_permutations <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Disable early stopping to always run all permutations</span></span>
<span><span class="va">sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>early_stopping <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>After computation, you can check convergence status:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginal_sage</span><span class="op">$</span><span class="va">converged</span>  <span class="co"># TRUE if converged early</span></span>
<span><span class="va">marginal_sage</span><span class="op">$</span><span class="va">n_permutations_used</span>  <span class="co"># Actual permutations used</span></span></code></pre></div>
<p>If a resampling with multiple iterations (i.e., not holdout) is
supplied, the value of <code>n_permutations_used</code> will be set as
the value for <code>n_permutations</code> in all subsequent iterations
to avoid some computational overhead.</p>
</div>
</div>
<div class="section level2">
<h2 id="conditional-sage">Conditional SAGE<a class="anchor" aria-label="anchor" href="#conditional-sage"></a>
</h2>
<p>Conditional SAGE uses conditional sampling (via ARF by default) to
marginalize features while preserving dependencies between the remaining
features. This can provide different insights, especially when features
are correlated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Conditional SAGE instance using a conditional sampler</span></span>
<span><span class="va">sampler_gaussian</span> <span class="op">=</span> <span class="va"><a href="../reference/ConditionalGaussianSampler.html">ConditionalGaussianSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conditional_sage</span> <span class="op">=</span> <span class="va"><a href="../reference/ConditionalSAGE.html">ConditionalSAGE</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    n_permutations <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>    sampler <span class="op">=</span> <span class="va">sampler_gaussian</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute SAGE values</span></span>
<span><span class="va">conditional_sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>batch_size <span class="op">=</span> <span class="fl">5000L</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualize the conditional SAGE results:</p>
<p><img src="sage-methods_files/figure-html/conditional-sage-plot-1.png" class="r-plt" width="768"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conditional_sage</span><span class="op">$</span><span class="fu">plot_convergence</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sage-methods_files/figure-html/convergance-conditional-1.png" class="r-plt" width="768"></p>
</div>
<div class="section level2">
<h2 id="comparison-of-methods">Comparison of Methods<a class="anchor" aria-label="anchor" href="#comparison-of-methods"></a>
</h2>
<p>Let’s compare the two SAGE methods side by side:</p>
<p><img src="sage-methods_files/figure-html/comparison-1.png" class="r-plt" width="768"></p>
<div class="section level3">
<h3 id="interpretation">Interpretation<a class="anchor" aria-label="anchor" href="#interpretation"></a>
</h3>
<!-- ((This explanation is wrong and doesn't match what we observe and needs to be corrected (and substantiated))) -->
<!-- The results demonstrate the difference between marginal and conditional SAGE:

1. **Marginal SAGE** treats each feature independently, so highly correlated features x1 and x2 both receive substantial importance scores reflecting their individual marginal contributions.

2. **Conditional SAGE** accounts for feature dependencies through conditional sampling. When marginalizing x1, it conditions on x2 (and vice versa), leading to lower importance scores for the correlated features since they provide redundant information.

3. **Independent feature x3** shows similar importance in both methods since it doesn't depend on other features.

4. **Noise feature x4** correctly receives near-zero importance in both methods.

This pattern mirrors the difference between PFI and CFI: marginal methods show inflated importance for correlated features, while conditional methods provide a more accurate assessment of each feature's unique contribution. -->
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-pfi-and-cfi">Comparison with PFI and CFI<a class="anchor" aria-label="anchor" href="#comparison-with-pfi-and-cfi"></a>
</h2>
<p>For reference, let’s compare SAGE methods with the analogous PFI and
CFI methods on the same data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick PFI and CFI comparison for context</span></span>
<span><span class="va">pfi</span> <span class="op">=</span> <span class="va"><a href="../reference/PFI.html">PFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">measure</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No <span style="color: #0000BB;">&lt;Resampling&gt;</span> provided</span></span>
<span><span class="co">#&gt; Using `resampling = rsmp("holdout")` with default `ratio = 0.67`.</span></span>
<span><span class="va">cfi</span> <span class="op">=</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">measure</span>, sampler <span class="op">=</span> <span class="va">sampler_gaussian</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No <span style="color: #0000BB;">&lt;Resampling&gt;</span> provided</span></span>
<span><span class="co">#&gt; Using `resampling = rsmp("holdout")` with default `ratio = 0.67`.</span></span>
<span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pfi_results</span> <span class="op">=</span> <span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cfi_results</span> <span class="op">=</span> <span class="va">cfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison data frame</span></span>
<span><span class="va">method_comparison</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="va">pfi_results</span><span class="op">$</span><span class="va">importance</span>,</span>
<span>        <span class="va">cfi_results</span><span class="op">$</span><span class="va">importance</span>,</span>
<span>        <span class="va">marginal_results</span><span class="op">$</span><span class="va">importance</span>,</span>
<span>        <span class="va">conditional_results</span><span class="op">$</span><span class="va">importance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PFI"</span>, <span class="st">"CFI"</span>, <span class="st">"Marginal SAGE"</span>, <span class="st">"Conditional SAGE"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    approach <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Marginal"</span>, <span class="st">"Conditional"</span>, <span class="st">"Marginal"</span>, <span class="st">"Conditional"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">method_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feature</span>, y <span class="op">=</span> <span class="va">importance</span>, fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"PFI"</span> <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>            <span class="st">"CFI"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>            <span class="st">"Marginal SAGE"</span> <span class="op">=</span> <span class="st">"lightcoral"</span>,</span>
<span>            <span class="st">"Conditional SAGE"</span> <span class="op">=</span> <span class="st">"darkred"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Comparison: PFI/CFI vs Marginal/Conditional SAGE"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Both pairs show similar patterns: marginal methods inflate correlated feature importance"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Features"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Importance Value"</span>,</span>
<span>        fill <span class="op">=</span> <span class="st">"Method"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="sage-methods_files/figure-html/pfi-cfi-comparison-1.png" class="r-plt" width="768"></p>
<!-- ((This similarly needs to be corrected))

**Key Observations:**

- **Marginal methods** (PFI, Marginal SAGE) both assign high importance to correlated features x1 and x2
- **Conditional methods** (CFI, Conditional SAGE) both reduce importance for correlated features, accounting for redundancy
- **Independent feature x3** receives consistent importance across all methods
- **Noise feature x4** is correctly identified as unimportant by all methods

This demonstrates that the marginal vs conditional distinction is a fundamental concept that applies across different importance method families. -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
