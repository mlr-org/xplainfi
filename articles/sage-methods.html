<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Shapley Additive Global Importance (SAGE) • xplainfi</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Shapley Additive Global Importance (SAGE)">
<script defer src="https://umami.jemu.name/script.js" data-website-id="248c8668-4908-4c63-86f7-db0a1b19758a"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>Method Showcase</h6></li>
    <li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-Based Methods (PFI, CFI, RFI)</a></li>
    <li><a class="dropdown-item" href="../articles/loco.html">Model Refitting Measures (LOCO, WVIM)</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global ImportancE (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Specialized Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/feature-samplers.html">Feature Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/inference.html">Inference for Feature Importances</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Testing &amp; Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/simulation-settings.html">Simulation Settings</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Shapley Additive Global Importance (SAGE)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/xplainfi/blob/v1.1.0/vignettes/articles/sage-methods.Rmd" class="external-link"><code>vignettes/articles/sage-methods.Rmd</code></a></small>
      <div class="d-none name"><code>sage-methods.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr-org.github.io/xplainfi/">xplainfi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Shapley Additive Global Importance (SAGE) is a feature importance
method based on cooperative game theory. It uses Shapley values to
distribute the model’s total prediction performance among features.
Unlike perturbation-based methods (PFI/CFI) that measure performance
degradation when features are perturbed, SAGE measures each feature’s
contribution through marginalization.</p>
<p>A key property of SAGE is that it provides a complete decomposition:
the sum of all SAGE values equals the difference between the model’s
performance and the performance when all features are marginalized.</p>
<p><code>xplainfi</code> provides two implementations:</p>
<ul>
<li>
<strong>MarginalSAGE</strong>: Marginalizes features independently
(standard SAGE implementation)</li>
<li>
<strong>ConditionalSAGE</strong>: Marginalizes features using
conditional sampling</li>
</ul>
<p><strong>Note on interpretation</strong>: SAGE’s theoretical
properties and interpretation differ from perturbation-based methods.
While PFI/CFI have clearer interpretations in terms of predictive
performance, SAGE’s results can be more challenging to interpret,
particularly when using conditional sampling. The choice of conditional
sampler can significantly affect results, and there is limited empirical
guidance on best practices. This vignette focuses on demonstrating the
methods rather than making strong interpretive claims.</p>
<p><strong>The SAGE estimator</strong> implemented here is what is
referred to as the “permutation estimator” in other implementations. It
works by first building up <code>n_permutations</code> permutations of
the feature vector and then successively evaluating prefixes of the
sequence from left to right as coalitions to evaluated. If a task has
features <code>(x1, x2, x3)</code>, one permutation could be
<code>(x2, x1, x3)</code>, resulting in these coalitions to be
evaluated: <code>(x2)</code>, <code>(x2, x1)</code>, and
<code>(x2, x1, x3)</code>. The empty coalition will always be evaluated,
resulting in a total number of evaluations of
<code>n_permutations * n_features + 1</code>.</p>
</div>
<div class="section level2">
<h2 id="demonstration-with-correlated-features">Demonstration with Correlated Features<a class="anchor" aria-label="anchor" href="#demonstration-with-correlated-features"></a>
</h2>
<p>To showcase the difference between Marginal and Conditional SAGE,
we’ll use the <code><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated()</a></code> function which creates a
simple linear DGP with two correlated features.</p>
<p><strong>Model:</strong> <span class="math display">\[(X_1, X_2)^T
\sim \text{MVN}(0, \Sigma)\]</span></p>
<p>where <span class="math inline">\(\Sigma\)</span> is a 2×2 covariance
matrix with 1 on the diagonal and correlation <span class="math inline">\(r\)</span> (default 0.5) on the off-diagonal.</p>
<p><span class="math display">\[X_3 \sim N(0,1), \quad X_4 \sim
N(0,1)\]</span> <span class="math display">\[Y = 2 \cdot X_1 + X_3 +
\varepsilon\]</span></p>
<p>where <span class="math inline">\(\varepsilon \sim N(0,
0.2^2)\)</span>.</p>
<p><strong>Data generating process:</strong></p>
<ul>
<li>
<code>x1</code> has a direct effect on y (β=2.0)</li>
<li>
<code>x2</code> is correlated with x1 (r = 0.5) but has no direct
effect on y</li>
<li>
<code>x3</code> is independent with a direct effect (β=1.0)</li>
<li>
<code>x4</code> is independent noise (β=0)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_dgp_scenarios.html">sim_dgp_correlated</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, r <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check the correlation structure</span></span>
<span><span class="va">task_data</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">correlation_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">task_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">correlation_matrix</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;        x1     x2     x3     x4</span></span>
<span><span class="co">#&gt; x1  1.000  0.447 -0.005 -0.048</span></span>
<span><span class="co">#&gt; x2  0.447  1.000 -0.049 -0.054</span></span>
<span><span class="co">#&gt; x3 -0.005 -0.049  1.000  0.051</span></span>
<span><span class="co">#&gt; x4 -0.048 -0.054  0.051  1.000</span></span></code></pre></div>
<p>This DGP allows us to observe how the two SAGE variants handle
correlated features with different roles in the data generating
process.</p>
<p>Let’s set up our learner and measure. We’ll use a random forest and
instantiate a resampling to ensure both methods see the same data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.ranger"</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"regr.mse"</span><span class="op">)</span></span>
<span><span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"holdout"</span><span class="op">)</span></span>
<span><span class="va">resampling</span><span class="op">$</span><span class="fu">instantiate</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="marginal-sage">Marginal SAGE<a class="anchor" aria-label="anchor" href="#marginal-sage"></a>
</h2>
<p>Marginal SAGE marginalizes features independently by averaging
predictions over a subset of <code>n_samples</code> observations drawn
from the test dataset. We use 15 permutations of the feature vector to
build coalitions, resulting in 61 evaluated coalitions
(<code>15 * 4 + 1</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Marginal SAGE instance</span></span>
<span><span class="va">marginal_sage</span> <span class="op">=</span> <span class="va"><a href="../reference/MarginalSAGE.html">MarginalSAGE</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    n_permutations <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fl">100L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute SAGE values</span></span>
<span><span class="va">marginal_sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>batch_size <span class="op">=</span> <span class="fl">5000L</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualize the results:</p>
<p><img src="sage-methods_files/figure-html/marginal-sage-plot-1.png" class="r-plt" alt="Bar chart with features on x-axis and SAGE values on y-axis. Bars colored by feature type (causal vs noise)." width="768"></p>
<p>We can also keep track of the SAGE value approximation across
permutations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginal_sage</span><span class="op">$</span><span class="fu">plot_convergence</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sage-methods_files/figure-html/convergence-marginal-1.png" class="r-plt" alt="Line plot with permutation number on x-axis and SAGE value on y-axis. Multiple colored lines showing convergence trajectory for each feature." width="768"></p>
<div class="section level3">
<h3 id="early-stopping-based-on-convergence">Early Stopping Based on Convergence<a class="anchor" aria-label="anchor" href="#early-stopping-based-on-convergence"></a>
</h3>
<p>SAGE supports early stopping to save computation time when the
importance values have converged. By default, early stopping is enabled
with <code>early_stopping = TRUE</code>. Convergence is detected by
monitoring the standard error (SE) of the SAGE value estimates in the
first resampling iteration.</p>
<p>SAGE normalizes the SE by the range of their values (max - min) to
make convergence detection scale-invariant across different loss
metrics. Convergence is detected when:</p>
<p><span class="math display">\[
\max_j \left(\frac{SE_j}{\max_i(\text{SAGE}_i) -
\min_i(\text{SAGE}_i)}\right) &lt; \text{threshold}
\]</span></p>
<p>The default threshold is <code>se_threshold = 0.01</code> (1%),
meaning convergence occurs when the relative SE is below 1% of the
importance range for all features, which is equivalent to the approach
in the Python implementation in the <code>fippy</code> package.</p>
<p>You can customize convergence detection in
<code>$compute()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># More strict convergence (requires more permutations)</span></span>
<span><span class="va">sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>early_stopping <span class="op">=</span> <span class="cn">TRUE</span>, se_threshold <span class="op">=</span> <span class="fl">0.005</span>, min_permutations <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Disable early stopping to always run all permutations</span></span>
<span><span class="va">sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>early_stopping <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>After computation, you can check convergence status:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marginal_sage</span><span class="op">$</span><span class="va">converged</span>  <span class="co"># TRUE if converged early</span></span>
<span><span class="va">marginal_sage</span><span class="op">$</span><span class="va">n_permutations_used</span>  <span class="co"># Actual permutations used</span></span></code></pre></div>
<p>If a resampling with multiple iterations (i.e., not holdout) is
supplied, the value of <code>n_permutations_used</code> will be set as
the value for <code>n_permutations</code> in all subsequent iterations
to avoid some computational overhead.</p>
</div>
</div>
<div class="section level2">
<h2 id="conditional-sage">Conditional SAGE<a class="anchor" aria-label="anchor" href="#conditional-sage"></a>
</h2>
<p>Conditional SAGE uses conditional sampling (via ARF by default) to
marginalize features while preserving dependencies between the remaining
features. This can provide different insights, especially when features
are correlated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Conditional SAGE instance using a conditional sampler</span></span>
<span><span class="va">sampler_gaussian</span> <span class="op">=</span> <span class="va"><a href="../reference/ConditionalGaussianSampler.html">ConditionalGaussianSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conditional_sage</span> <span class="op">=</span> <span class="va"><a href="../reference/ConditionalSAGE.html">ConditionalSAGE</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    task <span class="op">=</span> <span class="va">task</span>,</span>
<span>    learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>    measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>    resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>    n_permutations <span class="op">=</span> <span class="fl">15L</span>,</span>
<span>    n_samples <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>    sampler <span class="op">=</span> <span class="va">sampler_gaussian</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute SAGE values</span></span>
<span><span class="va">conditional_sage</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span>batch_size <span class="op">=</span> <span class="fl">5000L</span><span class="op">)</span></span></code></pre></div>
<p>Let’s visualize the conditional SAGE results:</p>
<p><img src="sage-methods_files/figure-html/conditional-sage-plot-1.png" class="r-plt" alt="Bar chart with features on x-axis and SAGE values on y-axis. Bars colored by feature type (causal vs noise)." width="768"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conditional_sage</span><span class="op">$</span><span class="fu">plot_convergence</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sage-methods_files/figure-html/convergence-conditional-1.png" class="r-plt" alt="Line plot with permutation number on x-axis and SAGE value on y-axis. Multiple colored lines showing convergence trajectory for each feature." width="768"></p>
</div>
<div class="section level2">
<h2 id="comparison-of-methods">Comparison of Methods<a class="anchor" aria-label="anchor" href="#comparison-of-methods"></a>
</h2>
<p>Let’s compare the two SAGE methods side by side:</p>
<p><img src="sage-methods_files/figure-html/comparison-1.png" class="r-plt" alt="Faceted grouped bar chart with two panels (Causal and Noise). Each panel shows features on x-axis with grouped bars for Marginal SAGE (blue) and Conditional SAGE (green)." width="768"></p>
<div class="section level3">
<h3 id="methodological-notes">Methodological Notes<a class="anchor" aria-label="anchor" href="#methodological-notes"></a>
</h3>
<p>The difference between the two methods:</p>
<ul>
<li><p><strong>MarginalSAGE</strong>: Marginalizes all out-of-coalition
features simultaneously by sampling from the marginal distribution, but
does not account for conditional dependencies between in-coalition and
out-of-coalition features.</p></li>
<li><p><strong>ConditionalSAGE</strong>: Uses conditional sampling to
“marginalize” out-of-coalition features while preserving the conditional
dependency structure between in-coalition and out-of-coalition
features.</p></li>
</ul>
<p>The interpretation of SAGE values, particularly for ConditionalSAGE,
can be affected by the specific conditional sampler used and the nature
of feature dependencies in the data. The choice of sampler can
significantly affect results, and there is currently limited empirical
guidance on best practices for different settings.</p>
</div>
</div>
<div class="section level2">
<h2 id="comparison-with-pfi-and-cfi">Comparison with PFI and CFI<a class="anchor" aria-label="anchor" href="#comparison-with-pfi-and-cfi"></a>
</h2>
<p>For reference, let’s compare SAGE methods with the analogous PFI and
CFI methods on the same data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick PFI and CFI comparison for context</span></span>
<span><span class="va">pfi</span> <span class="op">=</span> <span class="va"><a href="../reference/PFI.html">PFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">measure</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No <span style="color: #0000BB;">&lt;Resampling&gt;</span> provided, using `resampling = rsmp("holdout", ratio = 2/3)`</span></span>
<span><span class="co">#&gt;   (test set size: <span style="color: #0000BB;">333</span>)</span></span>
<span><span class="va">cfi</span> <span class="op">=</span> <span class="va"><a href="../reference/CFI.html">CFI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span>, <span class="va">learner</span>, <span class="va">measure</span>, sampler <span class="op">=</span> <span class="va">sampler_gaussian</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No <span style="color: #0000BB;">&lt;Resampling&gt;</span> provided, using `resampling = rsmp("holdout", ratio = 2/3)`</span></span>
<span><span class="co">#&gt;   (test set size: <span style="color: #0000BB;">333</span>)</span></span>
<span></span>
<span><span class="va">pfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cfi</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pfi_results</span> <span class="op">=</span> <span class="va">pfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">cfi_results</span> <span class="op">=</span> <span class="va">cfi</span><span class="op">$</span><span class="fu">importance</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison data frame</span></span>
<span><span class="va">method_comparison</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span>, <span class="st">"x3"</span>, <span class="st">"x4"</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="va">pfi_results</span><span class="op">$</span><span class="va">importance</span>,</span>
<span>        <span class="va">cfi_results</span><span class="op">$</span><span class="va">importance</span>,</span>
<span>        <span class="va">marginal_results</span><span class="op">$</span><span class="va">importance</span>,</span>
<span>        <span class="va">conditional_results</span><span class="op">$</span><span class="va">importance</span></span>
<span>    <span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PFI"</span>, <span class="st">"CFI"</span>, <span class="st">"Marginal SAGE"</span>, <span class="st">"Conditional SAGE"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>    approach <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Marginal"</span>, <span class="st">"Conditional"</span>, <span class="st">"Marginal"</span>, <span class="st">"Conditional"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create comparison plot</span></span>
<span><span class="co">#| fig.alt: "Grouped bar chart with features on x-axis and importance on y-axis. Four colored bars per feature for PFI, CFI, Marginal SAGE, and Conditional SAGE."</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">method_comparison</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feature</span>, y <span class="op">=</span> <span class="va">importance</span>, fill <span class="op">=</span> <span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span></span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>            <span class="st">"PFI"</span> <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>            <span class="st">"CFI"</span> <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>            <span class="st">"Marginal SAGE"</span> <span class="op">=</span> <span class="st">"lightcoral"</span>,</span>
<span>            <span class="st">"Conditional SAGE"</span> <span class="op">=</span> <span class="st">"darkred"</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>        title <span class="op">=</span> <span class="st">"Comparison: PFI/CFI vs Marginal/Conditional SAGE"</span>,</span>
<span>        subtitle <span class="op">=</span> <span class="st">"Comparing perturbation-based and Shapley-based importance methods"</span>,</span>
<span>        x <span class="op">=</span> <span class="st">"Features"</span>,</span>
<span>        y <span class="op">=</span> <span class="st">"Importance Value"</span>,</span>
<span>        fill <span class="op">=</span> <span class="st">"Method"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="sage-methods_files/figure-html/pfi-cfi-comparison-1.png" class="r-plt" alt="" width="768"></p>
<p>While both PFI/CFI and MarginalSAGE/ConditionalSAGE distinguish
between marginal and conditional approaches, these method families
measure fundamentally different quantities. PFI and CFI measure the drop
in predictive performance when features are perturbed, making their
interpretation in terms of prediction loss relatively straightforward.
SAGE methods measure each feature’s contribution to overall performance
through Shapley value decomposition, which involves a different
theoretical framework. The results shown here demonstrate the methods on
the same data, but direct comparisons of the numerical values should be
made with these methodological differences in mind.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
