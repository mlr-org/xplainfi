<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Shapley Additive Global Importance (SAGE) Base Class — SAGE • xplainfi</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Shapley Additive Global Importance (SAGE) Base Class — SAGE"><meta name="description" content="Base class for SAGE (Shapley Additive Global Importance)
feature importance based on Shapley values with marginalization.
This is an abstract class - use MarginalSAGE or ConditionalSAGE."><meta property="og:description" content="Base class for SAGE (Shapley Additive Global Importance)
feature importance based on Shapley values with marginalization.
This is an abstract class - use MarginalSAGE or ConditionalSAGE."><script defer src="https://umami.jemu.name/script.js" data-website-id="248c8668-4908-4c63-86f7-db0a1b19758a"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Method Showcase</h6></li>
    <li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-Based Methods (PFI, CFI, RFI)</a></li>
    <li><a class="dropdown-item" href="../articles/loco.html">Model Refitting Measures (LOCO, WVIM)</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global ImportancE (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Specialized Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/feature-samplers.html">Feature Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/inference.html">Inference for Feature Importances</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Testing &amp; Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/simulation-settings.html">Simulation Settings</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Shapley Additive Global Importance (SAGE) Base Class</h1>
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/xplainfi/blob/main/R/SAGE.R" class="external-link"><code>R/SAGE.R</code></a></small>
      <div class="d-none name"><code>SAGE.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Base class for SAGE (Shapley Additive Global Importance)
feature importance based on Shapley values with marginalization.
This is an abstract class - use <a href="MarginalSAGE.html">MarginalSAGE</a> or <a href="ConditionalSAGE.html">ConditionalSAGE</a>.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>SAGE uses Shapley values to fairly distribute the total prediction
performance among all features. Unlike perturbation-based methods,
SAGE marginalizes features by integrating over their distribution.
This is approximated by averaging predictions over a reference dataset.</p>
<p><strong>Standard Error Calculation</strong>: The standard errors (SE) reported in
<code>$convergence_history</code> reflect the uncertainty in Shapley value estimation
across different random permutations within a single resampling iteration.
These SEs quantify the Monte Carlo sampling error for a fixed trained model
and are only valid for inference about the importance of features for that
specific model. They do not capture broader uncertainty from model variability
across different train/test splits or resampling iterations.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Covert I, Lundberg S, Lee S (2020).
“Understanding Global Feature Contributions With Additive Importance Measures.”
In <em>Advances in Neural Information Processing Systems</em>, volume 33, 17212–17223.
<a href="https://proceedings.neurips.cc/paper/2020/hash/c7bf0b7c1a86d5eb3be2c722cf2cf746-Abstract.html" class="external-link">https://proceedings.neurips.cc/paper/2020/hash/c7bf0b7c1a86d5eb3be2c722cf2cf746-Abstract.html</a>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="MarginalSAGE.html">MarginalSAGE</a> <a href="ConditionalSAGE.html">ConditionalSAGE</a></p></div>
    </div>
    <div class="section level2">
    <h2 id="super-class">Super class<a class="anchor" aria-label="anchor" href="#super-class"></a></h2>
    <p><code><a href="FeatureImportanceMethod.html">xplainfi::FeatureImportanceMethod</a></code> -&gt; <code>SAGE</code></p>
    </div>
    <div class="section level2">
    <h2 id="public-fields">Public fields<a class="anchor" aria-label="anchor" href="#public-fields"></a></h2>
    <p></p><div class="r6-fields"><dl><dt><code>n_permutations</code></dt>
<dd><p>(<code>integer(1)</code>) Number of permutations to sample.</p></dd>


<dt><code>convergence_history</code></dt>
<dd><p>(<code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></code>) History of SAGE values during computation.</p></dd>


<dt><code>converged</code></dt>
<dd><p>(<code>logical(1)</code>) Whether convergence was detected.</p></dd>


<dt><code>n_permutations_used</code></dt>
<dd><p>(<code>integer(1)</code>) Actual number of permutations used.</p></dd>


</dl><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-SAGE-new"><code>SAGE$new()</code></a></p></li>
<li><p><a href="#method-SAGE-compute"><code>SAGE$compute()</code></a></p></li>
<li><p><a href="#method-SAGE-plot_convergence"><code>SAGE$plot_convergence()</code></a></p></li>
<li><p><a href="#method-SAGE-clone"><code>SAGE$clone()</code></a></p></li>
</ul></div><p><details open><summary>Inherited methods</summary><ul><li><span class="pkg-link" data-pkg="xplainfi" data-topic="FeatureImportanceMethod" data-id="importance"><a href="FeatureImportanceMethod.html#method-importance"><code>xplainfi::FeatureImportanceMethod$importance()</code></a></span></li>
<li><span class="pkg-link" data-pkg="xplainfi" data-topic="FeatureImportanceMethod" data-id="obs_loss"><a href="FeatureImportanceMethod.html#method-obs_loss"><code>xplainfi::FeatureImportanceMethod$obs_loss()</code></a></span></li>
<li><span class="pkg-link" data-pkg="xplainfi" data-topic="FeatureImportanceMethod" data-id="print"><a href="FeatureImportanceMethod.html#method-print"><code>xplainfi::FeatureImportanceMethod$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="xplainfi" data-topic="FeatureImportanceMethod" data-id="reset"><a href="FeatureImportanceMethod.html#method-reset"><code>xplainfi::FeatureImportanceMethod$reset()</code></a></span></li>
<li><span class="pkg-link" data-pkg="xplainfi" data-topic="FeatureImportanceMethod" data-id="scores"><a href="FeatureImportanceMethod.html#method-scores"><code>xplainfi::FeatureImportanceMethod$scores()</code></a></span></li>
</ul></details></p><hr><a id="method-SAGE-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Creates a new instance of the SAGE class.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/SAGE.html">SAGE</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">task</span>,</span>
<span>  <span class="va">learner</span>,</span>
<span>  measure <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  resampling <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_permutations <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="fl">5000L</span>,</span>
<span>  n_samples <span class="op">=</span> <span class="fl">100L</span>,</span>
<span>  early_stopping <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  se_threshold <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  min_permutations <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  check_interval <span class="op">=</span> <span class="fl">1L</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>task, learner, measure, resampling, features</code></dt>
<dd><p>Passed to FeatureImportanceMethod.</p></dd>


<dt><code>n_permutations</code></dt>
<dd><p>(<code>integer(1)</code>: <code>10L</code>) Number of permutations to sample for SAGE value estimation.
The total number of evaluated coalitions is <code>1 (empty) + n_permutations * n_features</code>.</p></dd>


<dt><code>batch_size</code></dt>
<dd><p>(<code>integer(1)</code>: <code>5000L</code>) Maximum number of observations to process in a single prediction call.</p></dd>


<dt><code>n_samples</code></dt>
<dd><p>(<code>integer(1)</code>: <code>100L</code>) Number of samples to use for marginalizing out-of-coalition features.
For <a href="MarginalSAGE.html">MarginalSAGE</a>, this is the number of marginal data samples ("background data" in other implementations).
For <a href="ConditionalSAGE.html">ConditionalSAGE</a>, this is the number of conditional samples per test instance retrieved from <code>sampler</code>.</p></dd>


<dt><code>early_stopping</code></dt>
<dd><p>(<code>logical(1)</code>: <code>TRUE</code>) Whether to enable early stopping based on convergence detection.</p></dd>


<dt><code>se_threshold</code></dt>
<dd><p>(<code>numeric(1)</code>: <code>0.01</code>) Convergence threshold for relative standard error.
Convergence is detected when the maximum relative SE across all features falls below this threshold.
Relative SE is calculated as SE divided by the range of importance values (max - min),
making it scale-invariant across different loss metrics.
Default of <code>0.01</code> means convergence when relative SE is below 1% of the importance range.</p></dd>


<dt><code>min_permutations</code></dt>
<dd><p>(<code>integer(1)</code>: <code>10L</code>) Minimum permutations before checking for convergence. Convergence is judged based on the standard errors of the estimated SAGE values,
which requires a sufficiently large number of samples (i.e., evaluated coalitions).</p></dd>


<dt><code>check_interval</code></dt>
<dd><p>(<code>integer(1)</code>: <code>1L</code>) Check convergence every N permutations.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-SAGE-compute"></a><div class="section">
<h3 id="method-compute-">Method <code>compute()</code><a class="anchor" aria-label="anchor" href="#method-compute-"></a></h3>
<p>Compute SAGE values.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">SAGE</span><span class="op">$</span><span class="fu">compute</span><span class="op">(</span></span>
<span>  store_backends <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  batch_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  early_stopping <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  se_threshold <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  min_permutations <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  check_interval <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>store_backends</code></dt>
<dd><p>(<code>logical(1)</code>) Whether to store data backends.</p></dd>


<dt><code>batch_size</code></dt>
<dd><p>(<code>integer(1)</code>: <code>5000L</code>) Maximum number of observations to process in a single prediction call.</p></dd>


<dt><code>early_stopping</code></dt>
<dd><p>(<code>logical(1)</code>: <code>TRUE</code>) Whether to check for convergence and stop early.</p></dd>


<dt><code>se_threshold</code></dt>
<dd><p>(<code>numeric(1)</code>: <code>0.01</code>) Convergence threshold for relative standard error.
SE is normalized by the range of importance values (max - min) to make convergence
detection scale-invariant. Default <code>0.01</code> means convergence when relative SE &lt; 1%.</p></dd>


<dt><code>min_permutations</code></dt>
<dd><p>(<code>integer(1)</code>: <code>10L</code>) Minimum permutations before checking convergence.</p></dd>


<dt><code>check_interval</code></dt>
<dd><p>(<code>integer(1)</code>: <code>1L</code>) Check convergence every N permutations.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-SAGE-plot_convergence"></a><div class="section">
<h3 id="method-plot-convergence-">Method <code>plot_convergence()</code><a class="anchor" aria-label="anchor" href="#method-plot-convergence-"></a></h3>
<p>Plot convergence history of SAGE values.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">SAGE</span><span class="op">$</span><span class="fu">plot_convergence</span><span class="op">(</span>features <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>features</code></dt>
<dd><p>(<code>character</code> | <code>NULL</code>) Features to plot. If NULL, plots all features.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A <a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot2</a> object</p>
</div>

</div><p></p><hr><a id="method-SAGE-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">SAGE</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

