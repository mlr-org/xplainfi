<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>(experimental) Conditional Inference Tree Conditional Sampler — ConditionalCtreeSampler • xplainfi</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.10/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="(experimental) Conditional Inference Tree Conditional Sampler — ConditionalCtreeSampler"><meta name="description" content="Implements conditional sampling using conditional inference trees (ctree).
Builds a tree predicting target features from conditioning features, then samples
from the terminal node corresponding to each test observation."><meta property="og:description" content="Implements conditional sampling using conditional inference trees (ctree).
Builds a tree predicting target features from conditioning features, then samples
from the terminal node corresponding to each test observation."><script defer src="https://umami.jemu.name/script.js" data-website-id="248c8668-4908-4c63-86f7-db0a1b19758a"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">xplainfi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/xplainfi.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Method Showcase</h6></li>
    <li><a class="dropdown-item" href="../articles/perturbation-importance.html">Perturbation-Based Methods (PFI, CFI, RFI)</a></li>
    <li><a class="dropdown-item" href="../articles/loco.html">Model Refitting Measures (LOCO, WVIM)</a></li>
    <li><a class="dropdown-item" href="../articles/sage-methods.html">Shapley Additive Global Importance (SAGE)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Specialized Topics</h6></li>
    <li><a class="dropdown-item" href="../articles/feature-samplers.html">Feature Samplers</a></li>
    <li><a class="dropdown-item" href="../articles/inference.html">Inference for Feature Importances</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Testing &amp; Validation</h6></li>
    <li><a class="dropdown-item" href="../articles/simulation-settings.html">Simulation Settings</a></li>
    <li><a class="dropdown-item" href="../articles/fippy-comparison.html">Comparison with fippy (Python)</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlr-org/xplainfi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>(experimental) Conditional Inference Tree Conditional Sampler</h1>
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/xplainfi/blob/main/R/ConditionalCtreeSampler.R" class="external-link"><code>R/ConditionalCtreeSampler.R</code></a></small>
      <div class="d-none name"><code>ConditionalCtreeSampler.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implements conditional sampling using conditional inference trees (ctree).
Builds a tree predicting target features from conditioning features, then samples
from the terminal node corresponding to each test observation.</p>
    </div>


    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This sampler approximates the conditional distribution \(P(X_B | X_A = x_A)\) by:</p><ol><li><p>Building a conditional inference tree with \(X_B\) as response and \(X_A\) as predictors</p></li>
<li><p>For each test observation, finding its terminal (leaf) node in the tree</p></li>
<li><p>Sampling uniformly from training observations in that same terminal node</p></li>
</ol><p>Conditional inference trees (ctree) use permutation tests to determine splits,
which helps avoid overfitting and handles mixed feature types naturally. The tree
partitions the feature space based on the conditioning variables, creating local
neighborhoods that respect the conditional distribution structure.</p>
<p><strong>Key advantages over other samplers:</strong></p><ul><li><p>Handles mixed feature types (continuous and categorical)</p></li>
<li><p>Non-parametric (no distributional assumptions)</p></li>
<li><p>Automatic feature selection (splits only on informative features)</p></li>
<li><p>Can capture non-linear conditional relationships</p></li>
<li><p>Statistically principled splitting criteria</p></li>
</ul><p><strong>Hyperparameters</strong> control tree complexity:</p><ul><li><p><code>mincriterion</code>: Significance level for splits (higher = fewer splits)</p></li>
<li><p><code>minsplit</code>: Minimum observations required for a split</p></li>
<li><p><code>minbucket</code>: Minimum observations in terminal nodes</p></li>
</ul><p>This implementation is inspired by shapr's ctree approach but simplified for our
use case (we build trees on-demand rather than pre-computing all subsets).</p>
<p><strong>Advantages:</strong></p><ul><li><p>Works with any feature types</p></li>
<li><p>Robust to outliers</p></li>
<li><p>Interpretable tree structure</p></li>
<li><p>Handles high-dimensional conditioning</p></li>
</ul><p><strong>Limitations:</strong></p><ul><li><p>Requires model fitting (slower than kNN)</p></li>
<li><p>Can produce duplicates if terminal nodes are small</p></li>
<li><p>Tree building time increases with data size</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hothorn T, Hornik K, Zeileis A (2006).
“Unbiased Recursive Partitioning: A Conditional Inference Framework.”
<em>Journal of Computational and Graphical Statistics</em>, <b>15</b>(3), 651–674.
<a href="https://doi.org/10.1198/106186006X133933" class="external-link">doi:10.1198/106186006X133933</a>
.</p>
<p>Aas K, Jullum M, Løland A (2021).
“Explaining Individual Predictions When Features Are Dependent: More Accurate Approximations to Shapley Values.”
<em>Artificial Intelligence</em>, <b>298</b>, 103502.
<a href="https://doi.org/10.1016/j.artint.2021.103502" class="external-link">doi:10.1016/j.artint.2021.103502</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="super-classes">Super classes<a class="anchor" aria-label="anchor" href="#super-classes"></a></h2>
    <p><code><a href="FeatureSampler.html">xplainfi::FeatureSampler</a></code> -&gt; <code><a href="ConditionalSampler.html">xplainfi::ConditionalSampler</a></code> -&gt; <code>ConditionalCtreeSampler</code></p>
    </div>
    <div class="section level2">
    <h2 id="public-fields">Public fields<a class="anchor" aria-label="anchor" href="#public-fields"></a></h2>
    <p></p><div class="r6-fields"><dl><dt><code>feature_types</code></dt>
<dd><p>(<code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code>) Feature types supported by the sampler.
Will be checked against the provied <a href="https://mlr3.mlr-org.com/reference/Task.html" class="external-link">mlr3::Task</a> to ensure compatibility.</p></dd>


<dt><code>tree_cache</code></dt>
<dd><p>(<code>environment</code>) Cache for fitted ctree models.</p></dd>


</dl><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-ConditionalCtreeSampler-new"><code>ConditionalCtreeSampler$new()</code></a></p></li>
<li><p><a href="#method-ConditionalCtreeSampler-clone"><code>ConditionalCtreeSampler$clone()</code></a></p></li>
</ul></div><p><details open><summary>Inherited methods</summary><ul><li><span class="pkg-link" data-pkg="xplainfi" data-topic="FeatureSampler" data-id="print"><a href="FeatureSampler.html#method-print"><code>xplainfi::FeatureSampler$print()</code></a></span></li>
<li><span class="pkg-link" data-pkg="xplainfi" data-topic="ConditionalSampler" data-id="sample"><a href="ConditionalSampler.html#method-sample"><code>xplainfi::ConditionalSampler$sample()</code></a></span></li>
<li><span class="pkg-link" data-pkg="xplainfi" data-topic="ConditionalSampler" data-id="sample_newdata"><a href="ConditionalSampler.html#method-sample_newdata"><code>xplainfi::ConditionalSampler$sample_newdata()</code></a></span></li>
</ul></details></p><hr><a id="method-ConditionalCtreeSampler-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Creates a new ConditionalCtreeSampler.</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/ConditionalCtreeSampler.html">ConditionalCtreeSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">task</span>,</span>
<span>  conditioning_set <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  mincriterion <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  minsplit <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  minbucket <span class="op">=</span> <span class="fl">7L</span>,</span>
<span>  use_cache <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>task</code></dt>
<dd><p>(<a href="https://mlr3.mlr-org.com/reference/Task.html" class="external-link">mlr3::Task</a>) Task to sample from.</p></dd>


<dt><code>conditioning_set</code></dt>
<dd><p>(<code>character</code> | <code>NULL</code>) Default conditioning set to use in <code>$sample()</code>.</p></dd>


<dt><code>mincriterion</code></dt>
<dd><p>(<code>numeric(1)</code>: <code>0.95</code>) Significance level threshold for splitting (1 - p-value).
Higher values result in fewer splits (simpler trees).</p></dd>


<dt><code>minsplit</code></dt>
<dd><p>(<code>integer(1)</code>: <code>20L</code>) Minimum number of observations required for a split.</p></dd>


<dt><code>minbucket</code></dt>
<dd><p>(<code>integer(1)</code>: <code>7L</code>) Minimum number of observations in terminal nodes.</p></dd>


<dt><code>use_cache</code></dt>
<dd><p>(<code>logical(1)</code>: <code>TRUE</code>) Whether to cache fitted trees.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ConditionalCtreeSampler-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ConditionalCtreeSampler</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tgen</a></span><span class="op">(</span><span class="st">"friedman1"</span><span class="op">)</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create sampler with default parameters</span></span></span>
<span class="r-in"><span><span class="va">sampler</span> <span class="op">=</span> <span class="va">ConditionalCtreeSampler</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">task</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Sample features conditioned on others</span></span></span>
<span class="r-in"><span><span class="va">test_data</span> <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span>rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sampled</span> <span class="op">=</span> <span class="va">sampler</span><span class="op">$</span><span class="fu">sample_newdata</span><span class="op">(</span></span></span>
<span class="r-in"><span>  feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"important2"</span>, <span class="st">"important3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  newdata <span class="op">=</span> <span class="va">test_data</span>,</span></span>
<span class="r-in"><span>  conditioning_set <span class="op">=</span> <span class="st">"important1"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://lukasburk.de" class="external-link">Lukas Burk</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

